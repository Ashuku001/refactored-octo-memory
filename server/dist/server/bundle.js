(()=>{var e={9521:(e,t,n)=>{n(818).config(),e.exports={development:{host:process.env.PG_HOST,username:process.env.PG_USERNAME,password:process.env.PG_PASSWORD,database:process.env.PG_DB,dialect:"postgres",pool:{max:5,min:0,acquire:3e4,idle:1e4}},production:{host:process.env.PG_HOST,username:process.env.PG_USERNAME,password:process.env.PG_PASSWORD,database:process.env.PG_DB,logging:!1,dialect:"postgres",pool:{max:5,min:0,acquire:3e4,idle:1e4}}}},3482:(e,t,n)=>{var r=n(9031).Sequelize,a=n(9521),o=n(3793);o=o.db;var s=a.production,i=new r(s.database,s.username,s.password,s),c={models:o(i),sequelize:i};t&&(t.db=c,t.sequelize=i)},618:(e,t,n)=>{var r=n(5124),a=[new r.transports.File({filename:"error.log",level:"error"}),new r.transports.File({filename:"combined.log",level:"verbose"})],o=r.createLogger({level:"info",format:r.format.json(),transports:a});t&&(t.logger=o)},8412:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.belongsTo(e.AdTemplate,{foreignKey:"templateId"}),this.hasMany(e.Message,{foreignKey:"adId",as:"messageAd"})}}]),t}(d);return n.init({merchantId:t.INTEGER,templateId:t.INTEGER,read:t.INTEGER,delivered:t.INTEGER,sent:t.INTEGER,failed:t.INTEGER,response:t.INTEGER},{sequelize:e,modelName:"Ad"}),n}},718:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.hasMany(e.Ad,{foreignKey:"templateId",as:"ads"}),this.hasMany(e.MarketingResponse,{foreignKey:"adTemplateId",as:"adTempResponses"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"adTempProduct"}),this.belongsTo(e.Message,{foreignKey:"messageId",as:"adTempMessage"})}}]),t}(d);return n.init({merchantId:t.INTEGER,name:t.STRING,leads:t.INTEGER,messageId:t.INTEGER,productId:t.INTEGER},{sequelize:e,modelName:"AdTemplate"}),n}},354:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId"}),this.hasMany(e.Category,{foreignKey:"billboardId"})}}]),t}(d);return n.init({storeId:t.INTEGER,label:t.STRING,imageUrl:t.STRING},{sequelize:e,modelName:"Billboard"}),n}},7190:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.ScheduleTask,{foreignKey:"scheduleTaskId",as:"bulkTempTask"})}}]),t}(d);return n.init({scheduleTaskId:t.INTEGER,message:t.TEXT,template:t.TEXT,customers:t.TEXT},{sequelize:e,modelName:"BulkTemplateTask"}),n}},8438:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveButton,{foreignKey:"interactiveButtonId",as:"buttonReply"}),this.belongsTo(e.Message,{foreignKey:"messageId",as:"mesBtnReply"})}}]),t}(d);return n.init({interactiveButtonId:t.INTEGER,messageId:t.INTEGER,buttonId:t.STRING,title:t.STRING},{sequelize:e,modelName:"ButtonRepliedAction"}),n}},6171:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveButton,{foreignKey:"interactiveButtonId",as:"buttons"})}}]),t}(d);return n.init({interactiveButtonId:t.INTEGER,buttonId:t.STRING,title:t.STRING},{sequelize:e,modelName:"ButtonReplyAction"}),n}},205:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId"}),this.belongsTo(e.Billboard,{foreignKey:"billboardId"}),this.hasMany(e.Product,{foreignKey:"categoryId"})}}]),t}(d);return n.init({storeId:t.INTEGER,billboardId:t.INTEGER,name:t.STRING},{sequelize:e,modelName:"Category"}),n}},491:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.belongsTo(e.Customer,{foreignKey:"customerId"}),this.hasMany(e.Message,{foreignKey:"chatId",as:"messages"}),this.hasMany(e.Conversation,{foreignKey:"chatId",as:"conversations"})}}]),t}(d);return n.init({merchantId:t.INTEGER,customerId:t.INTEGER},{sequelize:e,modelName:"Chat"}),n}},1462:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId"}),this.hasMany(e.Product,{foreignKey:"colorId"})}}]),t}(d);return n.init({name:t.STRING,value:t.STRING,storeId:t.INTEGER},{sequelize:e,modelName:"Color"}),n}},6002:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Chat,{foreignKey:"chatId",as:"conversations"})}}]),t}(d);return n.init({chatId:t.INTEGER,category:t.ENUM(["marketing","utility","service","authentication"]),expiryDate:t.DATE,status:t.STRING,conversationId:t.STRING,pricingModel:t.STRING},{sequelize:e,modelName:"Conversation"}),n}},1469:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.hasOne(e.Chat,{foreignKey:"customerId"}),this.hasMany(e.Message,{foreignKey:"customerId"}),this.hasOne(e.MarketingResponse,{foreignKey:"customerId",as:"customerLead"}),this.hasMany(e.Order,{foreignKey:"customerId",as:"customerOrder"})}}]),t}(d);return n.init({whatsapp_name:t.STRING,phone_number:t.STRING,first_name:t.STRING,last_name:t.STRING,merchantId:t.INTEGER},{sequelize:e,modelName:"Customer"}),n}},9673:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"document"})}}]),t}(d);return n.init({caption:t.TEXT,mimeType:t.STRING,sha256:t.STRING,filename:t.STRING,url:t.STRING,documentId:t.STRING,messageId:t.INTEGER},{sequelize:e,modelName:"DocumentMessage"}),n}},980:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Product,{foreignKey:"productId"})}}]),t}(d);return n.init({productId:t.INTEGER,storeId:t.INTEGER,url:t.STRING},{sequelize:e,modelName:"Image"}),n}},9921:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveButton,{foreignKey:"interactiveButtonId",as:"btnImageHead"}),this.belongsTo(e.InteractiveTemplate,{foreignKey:"interactiveTemplateId",as:"tempImageHead"})}}]),t}(d);return n.init({interactiveButtonId:t.INTEGER,interactiveTemplateId:t.INTEGER,link:t.STRING},{sequelize:e,modelName:"ImageHeader"}),n}},9833:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"image"})}}]),t}(d);return n.init({caption:t.TEXT,mimeType:t.STRING,sha256:t.STRING,url:t.STRING,imageId:t.STRING,AWbucketId:t.STRING,AWfileId:t.STRING,messageId:t.INTEGER},{sequelize:e,modelName:"ImageMessage"}),n}},3793:(e,t,n)=>{var r=n(9031);t&&(t.db=function(e){var t={},a=n(3963);return a.keys().map(a).forEach((function(n){var a=n(e,r);t[a.name]=a})),Object.keys(t).forEach((function(e){t[e].associate&&t[e].associate(t)})),t})},5117:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveMessage,{foreignKey:"interactiveMesId",as:"button"}),this.hasOne(e.ImageHeader,{foreignKey:"interactiveButtonId",as:"btnImageHead"}),this.hasOne(e.TextHeader,{foreignKey:"interactiveButtonId",as:"btnTextHead"}),this.hasMany(e.ButtonReplyAction,{foreignKey:"interactiveButtonId",as:"buttons"}),this.hasOne(e.ButtonRepliedAction,{foreignKey:"interactiveButtonId",as:"buttonReply"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"product"})}}]),t}(d);return n.init({interactiveMesId:t.INTEGER,header:t.ENUM(["TEXT","IMAGE","VIDEO","DOCUMENT"]),body:t.TEXT,action:t.ENUM(["BUTTON_REPLY"]),productId:t.INTEGER,footer:t.STRING},{sequelize:e,modelName:"InteractiveButton"}),n}},2193:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveMessage,{foreignKey:"interactiveMesId",as:"list"}),this.hasMany(e.ListSection,{foreignKey:"interactiveListId",as:"sections"}),this.hasOne(e.TextHeader,{foreignKey:"interactiveListId",as:"listTextHead"})}}]),t}(d);return n.init({interactiveMesId:t.INTEGER,header:t.ENUM(["TEXT"]),body:t.TEXT,footer:t.STRING,button:t.STRING},{sequelize:e,modelName:"InteractiveList"}),n}},8194:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"interactive"}),this.hasOne(e.InteractiveButton,{foreignKey:"interactiveMesId",as:"button"}),this.hasOne(e.InteractiveList,{foreignKey:"interactiveMesId",as:"list"}),this.hasOne(e.InteractiveTemplate,{foreignKey:"interactiveMesId",as:"template"})}}]),t}(d);return n.init({messageId:t.INTEGER,type:t.ENUM(["BUTTON","LIST","TEMPLATE"])},{sequelize:e,modelName:"InteractiveMessage"}),n}},2163:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveMessage,{foreignKey:"interactiveMesId",as:"template"}),this.hasOne(e.ImageHeader,{foreignKey:"interactiveTemplateId",as:"tempImageHead"}),this.hasOne(e.TextHeader,{foreignKey:"interactiveTemplateId",as:"tempTextHead"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"tempProduct"}),this.hasOne(e.TemplateRepliedAction,{foreignKey:"interactiveTemplateId",as:"tempReply"}),this.hasMany(e.TemplateReplyAction,{foreignKey:"interactiveTemplateId",as:"buttons"})}}]),t}(d);return n.init({interactiveMesId:t.INTEGER,header:t.ENUM(["TEXT","IMAGE","VIDEO","DOCUMENT","LOCATION"]),body:t.TEXT,footer:t.STRING,action:t.STRING,productId:t.INTEGER},{sequelize:e,modelName:"InteractiveTemplate"}),n}},3002:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.ListRowButton,{foreignKey:"listRowButtonId",as:"listReply"}),this.belongsTo(e.Message,{foreignKey:"messageId",as:"mesListReply"})}}]),t}(d);return n.init({listRowButtonId:t.INTEGER,messageId:t.INTEGER,buttonId:t.STRING,title:t.STRING,description:t.STRING},{sequelize:e,modelName:"ListRepliedAction"}),n}},8525:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.ListSection,{foreignKey:"listSectionId",as:"rows"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"product"}),this.hasOne(e.ListRepliedAction,{foreignKey:"listRowButtonId",as:"listReply"})}}]),t}(d);return n.init({listSectionId:t.INTEGER,productId:t.INTEGER,buttonId:t.STRING,title:t.STRING,description:t.STRING},{sequelize:e,modelName:"ListRowButton"}),n}},226:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveList,{foreignKey:"interactiveListId",as:"sections"}),this.hasMany(e.ListRowButton,{foreignKey:"listSectionId",as:"rows"})}}]),t}(d);return n.init({interactiveListId:t.INTEGER,title:t.STRING},{sequelize:e,modelName:"ListSection"}),n}},6007:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"location"})}}]),t}(d);return n.init({address:t.STRING,latitude:t.STRING,longitude:t.STRING,name:t.STRING,url:t.STRING,messageId:t.INTEGER},{sequelize:e,modelName:"LocationMessage"}),n}},4674:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Customer,{foreignKey:"customerId",as:"cusTempLead"}),this.belongsTo(e.Message,{foreignKey:"messageId",as:"mesTempLead"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"prodTempLead"}),this.belongsTo(e.AdTemplate,{foreignKey:"adTemplateId",as:"adTempResponses"})}}]),t}(d);return n.init({customerId:t.INTEGER,adTemplateId:t.INTEGER,messageId:t.INTEGER,productId:t.INTEGER,score:t.INTEGER},{sequelize:e,modelName:"MarketingResponse"}),n}},3785:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.hasMany(e.Customer,{as:"customers",foreignKey:"merchantId"}),this.hasMany(e.Chat,{foreignKey:"merchantId"}),this.hasMany(e.Ad,{foreignKey:"merchantId"}),this.hasMany(e.AdTemplate,{foreignKey:"merchantId"}),this.hasOne(e.Setting,{foreignKey:"merchantId"}),this.hasMany(e.Message,{foreignKey:"merchantId"}),this.hasMany(e.Store,{as:"merchatsStore",foreignKey:"merchantId"}),this.hasMany(e.ScheduleTask,{foreignKey:"merchantId",as:"merchantsTasks"})}}]),t}(d);return n.init({business_name:t.STRING,username:t.STRING,password:t.STRING,email:t.STRING,whatsapp_phone_number:t.STRING},{sequelize:e,modelName:"Merchant"}),n}},3050:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Chat,{foreignKey:"chatId"}),this.hasOne(e.TextMessage,{foreignKey:"messageId",as:"text"}),this.hasOne(e.ImageMessage,{foreignKey:"messageId",as:"image"}),this.hasOne(e.LocationMessage,{foreignKey:"messageId",as:"location"}),this.hasOne(e.VideoMessage,{foreignKey:"messageId",as:"video"}),this.hasOne(e.DocumentMessage,{foreignKey:"messageId",as:"document"}),this.hasOne(e.InteractiveMessage,{foreignKey:"messageId",as:"interactive"}),this.hasOne(e.ButtonRepliedAction,{foreignKey:"messageId",as:"mesBtnReply"}),this.hasOne(e.ListRepliedAction,{foreignKey:"messageId",as:"mesListReply"}),this.hasOne(e.TemplateRepliedAction,{foreignKey:"messageId",as:"mesTempReply"}),this.belongsTo(e.Ad,{foreignKey:"adId",as:"messageAd"}),this.hasOne(e.MarketingResponse,{foreignKey:"messageId",as:"mesTempLead"}),this.hasOne(e.AdTemplate,{foreignKey:"messageId",as:"adTempMessage"}),this.hasMany(e.Message,{foreignKey:"contextId",as:"contexts"}),this.belongsTo(e.Message,{foreignKey:"contextId",as:"context"}),this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.belongsTo(e.Customer,{foreignKey:"customerId"})}}]),t}(d);return n.init({from_customer:t.BOOLEAN,timestamp:t.DATE,type:t.ENUM(["TEXT","VIDEO","IMAGE","DOCUMENT","LOCATION","LOCATION","INTERACTIVE","BUTTON_REPLY","LIST_REPLY","TEMPLATE_REPLY"]),isAd:t.BOOLEAN,chatId:t.INTEGER,adId:t.INTEGER,customerId:t.INTEGER,merchantId:t.INTEGER,hasContext:t.BOOLEAN,contextId:t.INTEGER,messageId:t.STRING,status:t.ENUM(["read","delivered","sent"])},{sequelize:e,modelName:"Message"}),n}},6125:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId",as:"storeOrder"}),this.hasMany(e.OrderItem,{foreignKey:"orderId",as:"orderItems",onUpdate:"CASCADE"}),this.belongsTo(e.Customer,{foreignKey:"customerId",as:"customerOrder"})}}]),t}(d);return n.init({isPaid:t.BOOLEAN,orderID:t.STRING,status:t.ENUM(["CONFIRMED","PENDING","RECEIVED"]),phone:t.STRING,address:t.STRING,storeId:t.INTEGER,customerId:t.INTEGER},{sequelize:e,modelName:"Order"}),n}},5682:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Order,{foreignKey:"orderId",as:"orderItems",onUpdate:"CASCADE"}),this.belongsTo(e.Product,{foreignKey:"productId",as:"orderProduct"})}}]),t}(d);return n.init({orderId:t.INTEGER,price:t.DECIMAL,quantity:t.INTEGER,productId:t.INTEGER},{sequelize:e,modelName:"OrderItem"}),n}},1506:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId"}),this.belongsTo(e.Color,{foreignKey:"colorId"}),this.belongsTo(e.Size,{foreignKey:"sizeId"}),this.belongsTo(e.Category,{foreignKey:"categoryId"}),this.hasMany(e.Image,{foreignKey:"productId",as:"images"}),this.hasOne(e.OrderItem,{foreignKey:"productId",as:"orderProduct"}),this.hasMany(e.InteractiveButton,{foreignKey:"productId",as:"product"}),this.hasMany(e.InteractiveTemplate,{foreignKey:"productId",as:"tempProduct"}),this.hasMany(e.ListRowButton,{foreignKey:"productId",as:"listProduct"}),this.hasMany(e.MarketingResponse,{foreignKey:"productId",as:"productLead"}),this.hasMany(e.AdTemplate,{foreignKey:"productId",as:"adTempProduct"}),this.hasMany(e.ProductVariation,{foreignKey:"productId",as:"prodVariations"}),this.hasMany(e.ProductCombination,{foreignKey:"productId",as:"prodCombinations"})}}]),t}(d);return n.init({name:t.STRING,price:t.DECIMAL,isFeatured:t.BOOLEAN,isArchived:t.BOOLEAN,sizeId:t.INTEGER,colorId:t.INTEGER,categoryId:t.INTEGER,storeId:t.INTEGER},{sequelize:e,modelName:"Product"}),n}},5611:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Product,{foreignKey:"productId",as:"prodCombinations"}),this.hasOne(e.ProductImage,{foreignKey:"productCombinationId",as:"variantImage"}),this.belongsToMany(e.ProductVariationOption,{through:{model:"ProductVariants"},as:"productVariants",foreignKey:"productCombinationId",otherKey:"productVariationOptionId"})}}]),t}(d);return n.init({price:t.FLOAT,productId:t.INTEGER,sku:t.STRING,availableStock:t.STRING,combinationString:t.TEXT},{sequelize:e,modelName:"ProductCombination"}),n}},3769:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.ProductCombination,{foreignKey:"productCombinationId",as:"variantImage"})}}]),t}(d);return n.init({link:t.STRING,productCombinationId:t.INTEGER,storeId:t.INTEGER},{sequelize:e,modelName:"ProductImage"}),n}},9597:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){}}]),t}(d);return n.init({productCombinationId:t.INTEGER,productVariationOptionId:t.INTEGER},{sequelize:e,modelName:"ProductVariant"}),n}},3285:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Product,{foreignKey:"productId",as:"prodVariations"}),this.hasMany(e.ProductVariationOption,{foreignKey:"productVariationId",as:"prodVarOptions"})}}]),t}(d);return n.init({name:t.STRING,productId:t.INTEGER},{sequelize:e,modelName:"ProductVariation"}),n}},8084:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.ProductVariation,{foreignKey:"productVariationId",as:"prodVarOptions"}),this.belongsToMany(e.ProductCombination,{through:{model:"ProductVariants"},as:"productVariants",foreignKey:"productCombinationId",otherKey:"productVariationOptionId"})}}]),t}(d);return n.init({value:t.STRING,productVariationId:t.INTEGER},{sequelize:e,modelName:"ProductVariationOption"}),n}},9248:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){}}]),t}(d);return n.init({route:t.INTEGER,capacity:t.INTEGER},{sequelize:e,modelName:"Route"}),n}},2297:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.hasOne(e.BulkTemplateTask,{foreignKey:"scheduleTaskId",as:"bulkTempTask"}),this.belongsTo(e.Merchant,{foreignKey:"merchantId",as:"merchantsTasks"})}}]),t}(d);return n.init({merchantId:t.INTEGER,type:t.STRING,timestamp:t.DATE,status:t.ENUM(["EXECUTED","PENDING","FAILED"])},{sequelize:e,modelName:"ScheduleTask"}),n}},4921:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"})}}]),t}(d);return n.init({callBack_url:t.STRING,APP_ID:t.STRING,APP_SECRET:t.STRING,PHONE_NUMBER_ID:t.STRING,BUSINESS_ACCOUNT_ID:t.STRING,ACCESS_TOKEN:t.STRING,API_VERSION:t.STRING,WEBHOOK_VERIFICATION_TOKEN:t.STRING,RECIPIENT_PHONE_NUMBER:t.STRING,merchantId:t.INTEGER},{sequelize:e,modelName:"Setting"}),n}},9560:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Store,{foreignKey:"storeId"}),this.hasMany(e.Product,{foreignKey:"sizeId"})}}]),t}(d);return n.init({name:t.STRING,value:t.STRING,storeId:t.INTEGER},{sequelize:e,modelName:"Size"}),n}},9512:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Merchant,{foreignKey:"merchantId"}),this.hasMany(e.Billboard,{foreignKey:"storeId"}),this.hasMany(e.Category,{foreignKey:"storeId"}),this.hasMany(e.Size,{foreignKey:"storeId"}),this.hasMany(e.Color,{foreignKey:"storeId"}),this.hasMany(e.Product,{foreignKey:"storeId"}),this.hasMany(e.Order,{foreignKey:"storeId",as:"storeOrder"})}}]),t}(d);return n.init({name:t.STRING,merchantId:t.INTEGER},{sequelize:e,modelName:"Store"}),n}},1896:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveTemplate,{foreignKey:"interactiveTemplateId",as:"tempReply"}),this.belongsTo(e.Message,{foreignKey:"messageId",as:"mesTempReply"})}}]),t}(d);return n.init({messageId:t.INTEGER,text:t.STRING,payload:t.STRING,interactiveTemplateId:t.INTEGER},{sequelize:e,modelName:"TemplateRepliedAction"}),n}},1757:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveTemplate,{foreignKey:"interactiveTemplateId",as:"buttons"})}}]),t}(d);return n.init({interactiveTemplateId:t.INTEGER,text:t.STRING,type:t.STRING},{sequelize:e,modelName:"TemplateReplyAction"}),n}},7587:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.InteractiveButton,{foreignKey:"interactiveButtonId",as:"btnTextHead"}),this.belongsTo(e.InteractiveList,{foreignKey:"interactiveListId",as:"listTextHead"}),this.belongsTo(e.InteractiveTemplate,{foreignKey:"interactiveTemplateId",as:"tempTextHead"})}}]),t}(d);return n.init({interactiveButtonId:t.INTEGER,interactiveListId:t.INTEGER,interactiveTemplateId:t.INTEGER,body:t.TEXT},{sequelize:e,modelName:"TextHeader"}),n}},5487:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"text"})}}]),t}(d);return n.init({body:t.TEXT,messageId:t.INTEGER},{sequelize:e,modelName:"TextMessage"}),n}},5167:(e,t,n)=>{"use strict";var r=n(5998),a=n(8898),o=n(6609),s=n(9285),i=n(2750);function c(e,t,n){return t=s(t),o(e,u()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}var d=n(9031).Model;e.exports=function(e,t){var n=function(e){function t(){return r(this,t),c(this,t,arguments)}return i(t,e),a(t,null,[{key:"associate",value:function(e){this.belongsTo(e.Message,{foreignKey:"messageId",as:"video"})}}]),t}(d);return n.init({caption:t.TEXT,mimeType:t.STRING,sha256:t.STRING,videoId:t.STRING,url:t.STRING,messageId:t.INTEGER},{sequelize:e,modelName:"VideoMessage"}),n}},7906:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(7252).Router();n(818).config();var s=n(3268),i=n(4104),c=n(6919).createMessageTemplate,u=n(6919).listTemplates;o.use(s.json()),o.post("/",function(){var e=a(r.mark((function e(t,n,a){var o,s,d,l,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u();case 3:o=e.sent,console.log("##############I AM HERE IN CREATING TEMPLATES3<<<<<<<<<<<<<<#############",o),o.data.data.map((function(e){return console.log(e)})),s=o.data.data.filter((function(e){return"APPROVED"===e.status})),console.log("$%$%$%$%",s),d=i.messageTemplates,console.log("LOCLA TEMPLATES",d),console.log("#3333333#############################33",d.length),l=r.mark((function e(){var t,n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d[p],console.log("In here*(*(*(*(*(*"),n=s.filter((function(e){return e.name==process.env.TEMPLATE_NAME_PREFIX+"_"+t.name})),console.log("Creating template: ".concat(t.name,".")),!(n.length>0)){e.next=7;break}return console.log("Template ".concat(n[0].name," already exists.")),e.abrupt("return",1);case 7:return e.prev=7,e.next=10,c(t);case 10:console.log("Template ".concat(t.name," created successfully.")),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(7),console.log("Failed creating template ".concat(t.name,".")),console.log("###########",e.t0.response.data);case 17:case"end":return e.stop()}}),e,null,[[7,13]])})),p=0;case 13:if(!(p<d.length)){e.next=20;break}return e.delegateYield(l(),"t0",15);case 15:if(!e.t0){e.next=17;break}return e.abrupt("continue",17);case 17:p++,e.next=13;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(0),console.log("Failed obtaining remote template list."),console.log("##########",e.t1);case 26:console.log("Redirecting to the backoffice.");case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t,n,r){return e.apply(this,arguments)}}()),e.exports=o},8411:(e,t,n)=>{var r,a=n(7738),o=n(5564),s=n(4979),i=n(8059),c=(0,n(2369).gql)(r||(r=s(["\n  query setting($username: String!){\n    setting(username: $username){\n        APP_ID\n        APP_SECRET\n        PHONE_NUMBER_ID\n        BUSINESS_ACCOUNT_ID\n        ACCESS_TOKEN\n        API_VERSION\n        WEBHOOK_VERIFICATION_TOKEN\n        RECIPIENT_PHONE_NUMBER\n    }\n  }\n"])));function u(e){return d.apply(this,arguments)}function d(){return(d=o(a.mark((function e(t){var n,r,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=18;break}return e.prev=1,n={username:t},e.next=5,i.request(c,n);case 5:return r=e.sent,o=r.setting,s=o,console.log("SETTINGS FOR ".concat(t),s),e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(1),console.log("Failed to retrieve user settings>>>>>>>>>>"),console.log(e.t0);case 16:e.next=19;break;case 18:throw new Error("Failed to suppply the username");case 19:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function l(){return(l=o(a.mark((function e(t){var n,r,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.query.username)){e.next=17;break}return e.prev=2,e.next=5,u(n).then((function(e){return e}));case 5:if(r=e.sent,console.log("WEBHOOK VERIFICATION>>>>>".bgGreen,r.WEBHOOK_VERIFICATION_TOKEN),!(o=r.WEBHOOK_VERIFICATION_TOKEN)){e.next=10;break}return e.abrupt("return",o);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log("Error getting the verification token",e.t0);case 15:e.next=19;break;case 17:throw console.log("Could not find a username in the callback url"),new Error;case 19:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function p(){return(p=o(a.mark((function e(t){var n,r,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.query.username)){e.next=19;break}return e.prev=2,e.next=5,u(n).then((function(e){return e}));case 5:if(r=e.sent,console.log("THE SETTINGS",r),o=r.APP_SECRET,console.log("app secret>>>>>",o),!o){e.next=11;break}return e.abrupt("return",o);case 11:e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),console.log("Error getting the app secret"),new Error(e.t0);case 17:e.next=21;break;case 19:throw console.log("Could not find a username in the callback url"),new Error;case 21:case"end":return e.stop()}}),e,null,[[2,13]])})))).apply(this,arguments)}t&&(t.getSettings=u,t.getVerificationToken=function(e){return l.apply(this,arguments)},t.getAppSecret=function(e){return p.apply(this,arguments)})},8488:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(7252).Router(),s=(n(9173).messageStatuses,n(9113)),i=n(8430),c=(n(6919).sendWhatsAppMessage,n(8411)),u=c.getVerificationToken,d=c.getSettings,l=n(1255).getPayload;o.post("/",function(){var e=a(r.mark((function e(t,n,a){var o,c,u,p,m,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.query.username,e.next=3,d(o).then((function(e){return e}));case 3:if(c=e.sent,u=c.APP_SECRET,p=new s("SHA256",u),m=p.sign(t.rawBody).toLowerCase(),console.log("AOO SECRE>>>>>",u,p,m,t.headers["x-hub-signature-256"]),t.headers["x-hub-signature-256"]==m){e.next=12;break}return console.log("Warning - request header X-Hub-Signature not present or invalid"),n.sendStatus(401),e.abrupt("return");case 12:if(console.log("request header X-Hub-Signature validated"),h=t.body.entry[0].changes[0],l(t),"messages"===h.field){e.next=17;break}return e.abrupt("return",n.sendStatus(400));case 17:h.value.hasOwnProperty("messages")&&h.value.messages.forEach((function(e){return i(e,c)})),n.sendStatus(200);case 19:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),o.get("/",function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t).then((function(e){return e}));case 2:o=e.sent,console.log("VERIFICATION TOKEN",o),console.log("queries in Get",t.query),"subscribe"==t.query["hub.mode"]&&t.query["hub.verify_token"]==o?n.send(t.query["hub.challenge"]):n.sendStatus(400);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),e.exports=o},2511:(e,t,n)=>{var r=n(1116),a=n(6921),o=a.mapSchema,s=a.getDirective,i=a.MapperKind;t&&(t.authDirective=function(e){var t={};return{authDirectiveTypeDefs:"directive\n            @".concat(e," on QUERY | FIELD_DEFINITION | FIELD\n        "),authDirectiveTransformer:function(n){return o(n,r(r({},i.TYPE,(function(r){var a,o=null===(a=s(n,r,e))||void 0===a?void 0:a[0];o&&(t[r.name]=o)})),i.OBJECT_FIELD,(function(r,a,o){var i,c;if(null!==(i=null===(c=s(n,r,e))||void 0===c?void 0:c[0])&&void 0!==i?i:t[o]){var u=r.resolve;return r.defaultFieldResolver,r.resolve=function(e,t,n,r){if(n.merchant)return u(e,t,n,r);throw new Error("Unauthenticated. You need to be logged in!")},r}})))}}})},2078:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(618).logger,s=n(9577),i=s.getCustomer,c=s.getCusByNumber,u=s.getChat,d=n(3481),l=d.createCustomer,p=d.createChat,m=n(9580).sendTemplateMessage,h=function(){var e=a(r.mark((function e(t){var n,a,s,d,h,f,g,I,v,b,x,y,w,E,T,k,S,R,M,C,O,N,A,P,B,_,D,G,q,L,$,U,z;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.Merchant,a=t.Customer,s=t.Chat,d=t.Message,h=t.InteractiveMessage,f=void 0===h?void 0:h,g=t.InteractiveButton,I=void 0===g?void 0:g,v=t.InteractiveList,b=void 0===v?void 0:v,x=t.InteractiveTemplate,y=void 0===x?void 0:x,w=t.ListSection,E=void 0===w?void 0:w,T=t.participants,k=void 0===T?void 0:T,S=t.message,R=t.context,M=t.customerId,C=void 0===M?void 0:M,O=t.template,N=void 0===O?void 0:O,A=t.contextMessage,P=void 0===A?void 0:A,B=null,_=void 0,D=void 0,G=void 0,q=!1,L=null,$=null,!k){e.next=41;break}return U=k.mer_username,z=k.customer.phone_number,e.next=13,n.findOne({where:{username:U}});case 13:if(D=e.sent){e.next=16;break}throw new Error("Could not get merchant from received webhook",U);case 16:return e.next=18,c(a,z,D.id);case 18:if(_=e.sent){e.next=23;break}return e.next=22,l(a,k.customer,D.id);case 22:_=e.sent;case 23:return e.next=25,u(s,_.id,D.id);case 25:if(G=e.sent,console.log("CUSTOMER and merchant".bgBlue,_.id,D.id),G){e.next=38;break}return e.prev=28,e.next=31,p(s,_.id,D.id);case 31:G=e.sent,q=!0,e.next=38;break;case 35:e.prev=35,e.t0=e.catch(28),o.log({level:"error",message:"[ERROR CREATING CHAT] from webhook for, ".concat(D.id)});case 38:console.log("THE CHAT",G),e.next=80;break;case 41:if(e.prev=41,B=S.message.chatId,D=R.merchant,B&&!(B<0)){e.next=61;break}return e.next=47,i(a,C,D.id);case 47:if(_=e.sent){e.next=50;break}throw new Error("Customer not found make sure the customer is in your customer list.");case 50:if(!_){e.next=59;break}return e.next=53,u(s,_.id,D.id);case 53:if(G=e.sent){e.next=59;break}return e.next=57,p(s,_.id,D.id);case 57:G=e.sent,q=!0;case 59:e.next=70;break;case 61:return e.next=63,s.findOne({where:{id:B},include:[{model:a},{model:n}]});case 63:return G=e.sent,e.next=66,G.getCustomer();case 66:return _=e.sent,e.next=69,G.getMerchant();case 69:D=e.sent;case 70:e.next=75;break;case 72:e.prev=72,e.t1=e.catch(41),o.log({level:"error",message:"ERROR CREATING OR GETTING CHAT FOR MERCHANT, ".concat((new Date).toDateString())});case 75:if(!N){e.next=80;break}return console.log(N),e.next=79,m(N,_,D);case 79:L=e.sent;case 80:if(!P){e.next=103;break}if(!I){e.next=88;break}return console.log("inCluding button"),e.next=85,d.findOne({where:{messageId:P.messageId,chatId:G.id},include:[{model:f,as:"interactive",required:!0,include:[{model:I,as:"button",required:!0,include:["buttons"]}]}]});case 85:$=e.sent,e.next=103;break;case 88:if(!b){e.next=94;break}return e.next=91,d.findOne({where:{messageId:P.messageId,chatId:G.id},include:[{model:f,as:"interactive",required:!0,include:[{model:b,as:"list",include:[{model:E,as:"sections",include:["rows"]}]}]}]});case 91:$=e.sent,e.next=103;break;case 94:if(!y){e.next=100;break}return e.next=97,d.findOne({where:{messageId:P.messageId,chatId:G.id},include:[{model:f,as:"interactive",required:!0,include:[{model:y,as:"template",required:!0}]}]});case 97:$=e.sent,e.next=103;break;case 100:return e.next=102,d.findOne({where:{messageId:P.messageId,chatId:G.id}});case 102:$=e.sent;case 103:return e.abrupt("return",{customer:_,merchant:D,chat:G,addNewChat:q,messageId:L,contextedMessage:$});case 104:case"end":return e.stop()}}),e,null,[[28,35],[41,72]])})));return function(t){return e.apply(this,arguments)}}();e.exports={getCreateChatForMessage:h}},3481:(e,t,n)=>{var r=n(7738),a=n(1116),o=n(5564);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=function(){var e=o(r.mark((function e(t,n,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.create(i({},n)).then((function(e){return e.setMerchant(a),e}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),u=function(){var e=o(r.mark((function e(t,n,a){var s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.create({conversations:[{category:"marketing",expiryDate:null,status:"closed",conversationId:null,pricingModel:null},{category:"authentication",expiryDate:null,status:"closed",conversationId:null,pricingModel:null},{category:"utility",expiryDate:null,status:"closed",conversationId:null,pricingModel:null},{category:"service",expiryDate:null,status:"closed",conversationId:null,pricingModel:null}]},{include:{association:"conversations"}}).then(function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.setMerchant(a),t.setCustomer(n)]);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();e.exports={createCustomer:c,createChat:u}},9577:(e,t,n)=>{var r=n(7738),a=n(5564),o=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),s=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{name:n,merchantId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),i=function(){var e=a(r.mark((function e(t,n){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{label:n,storeId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),u=function(){var e=a(r.mark((function e(t,n){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),d=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{name:n,categoryId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),l=function(){var e=a(r.mark((function e(t,n){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),p=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{name:n,billboardId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),m=function(){var e=a(r.mark((function e(t,n){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{name:n,storeId:a}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),f=function(){var e=a(r.mark((function e(t,n){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{name:n,storeId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:parseInt(n),merchantId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),v=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{phone_number:n,merchantId:parseInt(a)}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),b=function(){var e=a(r.mark((function e(t,n,a){var o,s,i=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,void 0===(o=i.length>3&&void 0!==i[3]?i[3]:void 0)){e.next=8;break}return e.next=5,t.findOne({where:{merchantId:parseInt(a),id:parseInt(o)}});case 5:s=e.sent,e.next=12;break;case 8:if(!n||!a){e.next=12;break}return e.next=11,t.findOne({where:{merchantId:parseInt(a),customerId:parseInt(n)}});case 11:s=e.sent;case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),x=function(){var e=a(r.mark((function e(t,n,a){var o,s,i=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,void 0===(o=i.length>3&&void 0!==i[3]?i[3]:void 0)){e.next=8;break}return e.next=5,t.findOne({where:{merchantId:parseInt(a),id:parseInt(o)}});case 5:s=e.sent,e.next=12;break;case 8:if(!n||!a){e.next=12;break}return e.next=11,t.findOne({where:{merchantId:parseInt(a),customerId:parseInt(n)}});case 11:s=e.sent;case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{merchantId:n,name:a}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),w=function(){var e=a(r.mark((function e(t,n,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({where:{id:a,merchantId:n}});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();e.exports={getStore:o,getDupStore:s,getBillboard:i,getDupBillboard:c,getCategory:l,getDupCategory:p,getSize:m,getDupSize:h,getColor:f,getDupColor:g,getProduct:u,getDupProduct:d,getCustomer:I,getCusByNumber:v,getChat:b,getMessage:x,getAdTemplate:y,getAd:w}},3338:(e,t,n)=>{var r=n(1253),a=r.GraphQLScalarType,o=r.Kind,s=new a({name:"Date",description:"Date custom scalar type",serialize:function(e){if(e instanceof Date)return e.getTime();throw Error("GraphQL Date Scalar serializer expected a `Date` object")},parseValue:function(e){if("number"==typeof e)return new Date(e);throw new Error("GraphQL Date Scalar parser expected a `number`")},parseLiteral:function(e){return e.kind===o.INT?new Date(parseInt(e.value,10)):null}}),i=new a({name:"Decimal",description:"Decimal custom scalar type",serialize:function(e){if(e instanceof i)return e.getTime();throw Error("GraphQL Decimal Scalar serializer expected a `Decimal` object")},parseValue:function(e){if("number"==typeof e)return new Date(e);throw new Error("GraphQL Date Scalar parser expected a `number`")},parseLiteral:function(e){return e.kind===o.INT?new Date(parseInt(e.value,10)):null}});t&&(t.Date=s)},9580:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(618).logger,s=n(6919).sendWhatsAppMessage,i=function(){var e=a(r.mark((function e(t,n,a){var i,c,u,d,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=JSON.parse(t),c=n.dataValues.phone_number,i.to=c,e.next=6,a.getSetting();case 6:return u=(u=e.sent).dataValues,console.log("TEMPLATE DATA>>>>>>>>>",i),e.next=11,s(i,u);case 11:return d=e.sent,l=d.data,console.log("After sending the template message".bgCyan,l),messageId=l.messages[0].id,e.abrupt("return",messageId);case 18:e.prev=18,e.t0=e.catch(0),console.log(e.t0.message),o.log({level:"error",message:"[ERROR SENDING MESSAGE TO CUSTOMER] for ".concat(a.id)});case 22:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n,r){return e.apply(this,arguments)}}();e.exports={sendTemplateMessage:i}},4284:(e,t)=>{t&&(t.setCookie=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new Date;r.setDate(r.getDate()+1),e.cookies.set("authorization",t,{signed:!0,expires:n?new Date:r,httpOnly:!0,secure:!1,sameSite:"strict"})})},6495:(e,t,n)=>{var r=n(7738),a=n(1116),o=n(5564);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=n(9577).getAd,u=function(){var e=o(r.mark((function e(t){var n,a,o,s,u,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.Ad,a=t.merchantId,o=t.adId,s=t.MarketingResponse,u=t.response,e.next=3,c(n,a,o);case 3:if(l=e.sent,console.log("updating marketing id".bgBlue,l),!l){e.next=10;break}return e.next=8,n.update(i(i({},l),{},{response:null!==l.response?l.response+=1:1}),{where:{id:l.id},silent:!1});case 8:e.sent,d({MarketingResponse:s,response:i(i({},u),{},{adTemplateId:l.templateId})});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=o(r.mark((function e(t){var n,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.MarketingResponse,a=t.response,e.next=3,n.create(i({},a));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports={tempMarketPerformance:u}},6617:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(6299).ApolloServer,s=n(5963).makeExecutableSchema,i=n(3133).ApolloServerPluginDrainHttpServer,c=n(7252),u=n(8611);n(818).config;var d=n(7898),l=n(6854),p=n(2511).authDirective,m=c(),h=u.createServer(m);e.exports={server:function(e){var t=p("auth"),n=t.authDirectiveTypeDefs,c=t.authDirectiveTransformer,u=s({typeDefs:[n,l],resolvers:d.call(e)});return u=c(u),new o({schema:u,plugins:[i({httpServer:h}),{serverWillStart:function(){return a(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{drainServer:function(){return a(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,subscriptionServer.dispose();case 2:case"end":return e.stop()}}),e)})))()}});case 1:case"end":return e.stop()}}),e)})))()}}]})}}},7898:(e,t,n)=>{var r=n(4433),a=n(1116),o=n(7738),s=n(5564);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=n(618).logger;n(3672),n(818).config();var d=n(6919).sendWhatsAppMessage,l=n(5486),p=n(829),m=n(9031).Op,h=n(4284).setCookie,f=n(3946),g=f.withFilter,I=f.PubSub,v=n(9577),b=v.getStore,x=v.getBillboard,y=v.getCategory,w=v.getSize,E=v.getColor,T=v.getProduct,k=v.getDupProduct,S=v.getDupStore,R=v.getDupBillboard,M=v.getDupCategory,C=v.getDupSize,O=v.getDupColor,N=v.getCustomer,A=v.getCusByNumber,P=v.getChat,B=(v.getMessage,v.getAdTemplate,v.getAd),_=n(3481),D=_.createCustomer,G=_.createChat,q=n(9173).messageStatuses,L=n(2078).getCreateChatForMessage,$=n(6495).tempMarketPerformance,U=new I,z=process.env.JWT_SECRET;e.exports=function(){var e=this.db.db.models,t=e.Customer,n=e.Merchant,i=e.Chat,f=e.Conversation,I=e.Message,v=e.Setting,_=e.Product,K=(e.ProductVariationOption,e.Image),H=e.Store,j=e.Billboard,V=e.Category,F=e.Size,W=e.Color,Y=e.TextMessage,X=e.ImageMessage,Q=e.DocumentMessage,J=e.VideoMessage,Z=e.InteractiveMessage,ee=e.InteractiveButton,te=e.InteractiveTemplate,ne=(e.ButtonReplyAction,e.InteractiveList),re=e.ListRowButton,ae=e.ListSection,oe=e.ButtonRepliedAction,se=e.ListRepliedAction,ie=e.TemplateRepliedAction,ce=(e.ImageHeader,e.Order),ue=(e.OrderItem,e.TextHeader),de=e.Ad,le=e.AdTemplate,pe=e.MarketingResponse,me=e.ScheduleTask,he=(e.BulkTemplateTask,{Customer:{merchant:function(e,t,n){return e.getMerchant()}},Chat:{messages:function(e,t,n){return e.getMessages({order:[["createdAt","ASC"]]})},merchant:function(e,t,n){return e.getMerchant()},customer:function(e,t,n){return e.getCustomer()}},Message:{chat:function(e,t,n){return e.getChat()}},Ad:{adTemplate:function(e,t,n){return e.getAdTemplate()}},Merchant:{customers:function(e,t,n){return e.getCustomers()},setting:function(e,t,n){return e.getSetting()},products:function(e,t,n){return e.getProducts()},chats:function(e,t,n){return e.getChats({order:[["createdAt","ASC"]]})},stores:function(e,t,n){return e.getStore()}},Store:{merchant:function(e,t,n){return e.getMerchant()},billboards:function(e,t,n){return e.getBillboards()},sizes:function(e,t,n){return e.getSizes()},colors:function(e,t,n){return e.getColors()},products:function(e,t,n){return e.getProducts()}},Billboard:{store:function(e,t,n){return e.getStore()},categories:function(e,t,n){return e.getCategories()}},Category:{billboard:function(e,t,n){return e.getBillboard()},store:function(e,t,n){return e.getStore()},products:function(e,t,n){return e.getProducts()}},Size:{store:function(e,t,n){return e.getStore()}},Color:{store:function(e,t,n){return e.getStore()}},Product:{store:function(e,t,n){return e.getStore()},category:function(e,t,n){return e.getCategory()},size:function(e,t,n){return e.getSize()},color:function(e,t,n){return e.getColor()},images:function(e,t,n){return e.getImages()}},RootQuery:{currentMerchant:function(e,t,n){return s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.merchant);case 1:case"end":return e.stop()}}),e)})))()},customers:function(e,t,r){return s(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.findOne({where:{id:r.merchant.id}});case 2:if(t=e.sent){e.next=5;break}throw new Error("It seems you are not registered. Sign up to start managing your customers");case 5:return e.next=7,t.getCustomers();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))()},customer:function(e,n,r){return s(o.mark((function e(){var a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.customerId,e.next=3,t.findOne({where:{id:a,merchantId:r.merchant.id}});case 3:if(s=e.sent){e.next=6;break}throw new Error("Unautharized operation could not find the customer");case 6:return e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))()},customer360:function(e,n,r){return s(o.mark((function e(){var a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.customerId,s=r.merchant){e.next=4;break}throw new Error("Unauthenticated! Make sure you are logged in.");case 4:return e.next=6,t.findOne({where:{id:a,merchantId:s.id},include:[{association:"customerOrder",include:[{association:"storeOrder"},{association:"orderItems",include:{association:"orderProduct"}}]}]});case 6:if(i=e.sent){e.next=9;break}throw new Error("Unautharized operation could not find the customer");case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))()},customerChatSearch:function(e,n,r){return s(o.mark((function e(){var s,c,u,d,l,p,h,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.page,c=n.limit,u=n.text,d=[],!(u.length<3)){e.next=4;break}return e.abrupt("return",{customers:d});case 4:return l=0,s&&c&&(l=s*c),p={order:[["createdAt","DESC"]],offset:l},c&&(p.limit=c),p.where=a({},m.or,[{first_name:a({},m.iLike,"%"+u+"%"),merchantId:r.merchant.id},{last_name:a({},m.iLike,"%"+u+"%"),merchantId:r.merchant.id},{phone_number:a({},m.iLike,"%"+u+"%"),merchantId:r.merchant.id}]),e.next=11,t.findAll(p);case 11:if(0!==(d=e.sent).length){e.next=14;break}throw new Error('No results found for "'.concat(u,'"'));case 14:return h=d.map((function(e){return e.id})),e.next=17,i.findAll({where:{merchantId:r.merchant.id,customerId:a({},m.in,h)}});case 17:if(!(f=e.sent)){e.next=22;break}return e.next=21,d.filter((function(e){return f.every((function(t){return e.id!==t.customerId}))}));case 21:d=e.sent;case 22:return e.abrupt("return",{customers:d,chats:f});case 23:case"end":return e.stop()}}),e)})))()},customersSearch:function(e,n,r){return s(o.mark((function e(){var s,i,c,u,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.page,i=n.limit,c=n.text,u=[],!(c.length<3)){e.next=4;break}return e.abrupt("return",{customers:u});case 4:return d=0,s&&i&&(d=s*i),l={order:[["createdAt","DESC"]],offset:d},i&&(l.limit=i),l.where=a({},m.or,[{first_name:a({},m.iLike,"%"+c+"%"),merchantId:r.merchant.id},{last_name:a({},m.iLike,"%"+c+"%"),merchantId:r.merchant.id},{phone_number:a({},m.iLike,"%"+c+"%"),merchantId:r.merchant.id}]),e.next=11,t.findAll(l);case 11:return 0===(u=e.sent).length&&console.log("Customer not found with the name".bgRed,c),e.abrupt("return",u);case 14:case"end":return e.stop()}}),e)})))()},chats:function(e,r,a){return s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.findOne({where:{id:a.merchant.id}});case 2:if(e.sent){e.next=5;break}throw new Error("It seems you are not registered. Sign up to start managing your customers");case 5:return e.abrupt("return",i.findAll({where:{merchantId:a.merchant.id},order:[["updatedAt","DESC"]],include:[{model:t,required:!0}]}));case 6:case"end":return e.stop()}}),e)})))()},lastMessage:function(e,t,n){return s(o.mark((function e(){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.chatId,n.merchant){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in.");case 3:if(!r){e.next=8;break}return e.next=6,I.findAll({where:{chatId:r},include:[{model:Y,as:"text"},{model:X,as:"image"},{model:Q,as:"document"},{model:J,as:"video"},{model:Z,as:"interactive",include:[{model:ee,as:"button",include:["buttons","product"]},{model:te,as:"template",include:["buttons","tempProduct"]},{model:ne,as:"list",include:[{model:ue,as:"listTextHead"},{model:ae,as:"sections",include:[{model:re,as:"rows",include:["product"]}]}]}]},{model:oe,as:"mesBtnReply",required:!1,include:[{model:ee,as:"buttonReply",include:["product"]}]},{model:ie,as:"mesTempReply",required:!1,include:[{model:te,as:"tempReply",include:["tempProduct"]}]},{model:se,as:"mesListReply",required:!1,include:[{model:re,as:"listReply",include:["product"]}]},{model:i}],order:[["createdAt","DESC"]],limit:1});case 6:return a=e.sent,e.abrupt("return",a[0]);case 8:case"end":return e.stop()}}),e)})))()},chat:function(e,r,a){return s(o.mark((function e(){var s,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.chatId,e.next=3,n.findOne({where:{id:a.merchant.id}});case 3:if(e.sent){e.next=6;break}throw new Error("Unauthenticated make sure you are logged in");case 6:return e.next=8,i.findOne({where:{id:s,merchantId:a.merchant.id},include:[{model:I,as:"messages",include:[{model:de,as:"messageAd"},{model:I,as:"contexts",include:["text","image","document","video","interactive"]},{model:I,as:"context",include:[{model:Y,as:"text",required:!1},{model:X,as:"image",required:!1},{model:Q,as:"document",required:!1},{model:J,as:"video",required:!1},{model:Z,as:"interactive",include:[{model:ee,as:"button",include:["product"]},{model:te,as:"template",include:["tempProduct"]},{model:ne,as:"list",include:[{model:ue,as:"listTextHead"}]}]}]},{model:Y,as:"text",required:!1},{model:X,as:"image",required:!1},{model:Q,as:"document",required:!1},{model:J,as:"video",required:!1},{model:oe,as:"mesBtnReply",required:!1,include:[{model:ee,as:"buttonReply",include:["product"]}]},{model:ie,as:"mesTempReply",required:!1,include:[{model:te,as:"tempReply",include:["tempProduct"]}]},{model:se,as:"mesListReply",required:!1,include:[{model:re,as:"listReply",include:["product"]}]},{model:Z,as:"interactive",required:!1,include:[{model:ee,as:"button",include:["btnImageHead","btnTextHead","buttons","product"]},{model:te,as:"template",include:["tempImageHead","tempTextHead","buttons","tempProduct"]},{model:ne,as:"list",include:[{model:ue,as:"listTextHead"},{model:ae,as:"sections",include:[{model:re,as:"rows",include:["product"]}]}]}]}]},{model:t},{model:f,as:"conversations"}],order:[[{model:I,as:"messages"},"createdAt","ASC"]]});case 8:if(c=e.sent){e.next=11;break}throw new Error("Unauthorized operation");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))()},ads:function(e,t,n){return s(o.mark((function e(){var a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r(t),a=n.merchant){e.next=4;break}throw new Error("Unauthenticated please make sure you are logged in.");case 4:return e.next=6,de.findAll({where:{merchantId:a.id},include:{model:le},order:[["createdAt","DESC"]]});case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))()},tempMarketResponse:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.adTemplateId,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated please make sure you are logged in.");case 4:return e.next=6,le.findOne({where:{merchantId:a.id,id:r},include:[{association:"adTempProduct"},{association:"adTempMessage",include:{association:"interactive",include:{association:"template",include:["buttons"]}}},{association:"adTempResponses",include:[{association:"cusTempLead"},{association:"mesTempLead",include:["mesTempReply"]}]}]});case 6:if(s=e.sent){e.next=9;break}throw new Error("We could not find your ad Template");case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})))()},setting:function(e,t,r){return s(o.mark((function e(){var a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.username,s=null,!a||r.merchant){e.next=11;break}return e.next=5,n.findOne({where:{username:a}});case 5:if(s=e.sent){e.next=9;break}return u.log({level:"error",message:'error retriving settings for merchant requested by webhook, "'.concat(a,'" could not find the username')}),e.abrupt("return");case 9:e.next=12;break;case 11:s=r.merchant;case 12:if(s){e.next=14;break}throw new Error("Failed to authenticate you while retrieving settings Contact us to solve this");case 14:return e.next=16,s.getSetting();case 16:if(!(i=e.sent)){e.next=21;break}return e.abrupt("return",i);case 21:throw new Error("Could not retrieve your WhatsApp business setting. Please ensure to add your settings from the settings page.");case 22:case"end":return e.stop()}}),e)})))()},stores:function(e,t,n){return s(o.mark((function e(){var t,r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.next=3,n.merchant;case 3:if(r=e.sent){e.next=6;break}throw new Error("Make sure you are logged in to access your products");case 6:return(a={order:[["createdAt","DESC"]]}).where={"$Store.merchantId$":r.id},e.next=10,H.findAll(a);case 10:if(t=e.sent){e.next=13;break}throw new Error("Add stores to view them here");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))()},store:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,n.merchant){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(!r){e.next=12;break}return e.next=6,b(H,r,n.merchant.id);case 6:if(a=e.sent){e.next=9;break}throw new Error("Could not find the store");case 9:return e.abrupt("return",a);case 12:return e.next=14,H.findAll({limit:1,where:{merchantId:n.merchant.id},order:[["createdAt","DESC"]]}).then((function(e){return e[0]}));case 14:return s=e.sent,e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)})))()},billboards:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in");case 4:if(r){e.next=6;break}throw new Error("We couldn't find a store ID");case 6:return e.prev=6,e.next=9,b(H,r,a.id);case 9:if(e.sent){e.next=12;break}throw new Error("Unauthorized operation");case 12:if(s=j.findAll({where:{storeId:r}})){e.next=15;break}throw new Error("This store has no billboards yet");case 15:return e.abrupt("return",s);case 18:throw e.prev=18,e.t0=e.catch(6),u.log({level:"error",message:"An error occurred for ".concat(a.id," while querying for billboards")}),new Error("Something went wrong while getting your billboards",e.t0);case 22:case"end":return e.stop()}}),e,null,[[6,18]])})))()},billboard:function(e,t,n){return s(o.mark((function e(){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.billboardId,e.prev=1,e.next=4,j.findOne({where:{id:n}});case 4:if(r=e.sent){e.next=7;break}throw new Error("Could not find the billboard");case 7:return e.abrupt("return",r);case 10:throw e.prev=10,e.t0=e.catch(1),new Error("Something went wrong",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))()},categories:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,a=n.merchant,r){e.next=4;break}throw new Error("Billboard id is required.");case 4:if(e.prev=4,s=V.findAll({where:{storeId:r}})){e.next=8;break}throw new Error("This billboard has no categories yet");case 8:return e.abrupt("return",s);case 11:throw e.prev=11,e.t0=e.catch(4),u.log({level:"error",message:"An error occurred for ".concat(a.id," while querying for categories")}),new Error("Something went wrong while getting your categories",e.t0);case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))()},category:function(e,t,n){return s(o.mark((function e(){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.categoryId,e.prev=1,n){e.next=4;break}throw new Error("Category Id is required");case 4:return e.next=6,y(V,n);case 6:if(r=e.sent){e.next=9;break}throw new Error("Could not find the category");case 9:return e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(1),new Error("Something went wrong",e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))()},sizes:function(e,t,n){return s(o.mark((function e(){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,n.merchant,r){e.next=4;break}throw new Error("Billboard id is required.");case 4:if(a=F.findAll({where:{storeId:r}})){e.next=7;break}throw new Error("This billboard has no categories yet");case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))()},size:function(e,t,n){return s(o.mark((function e(){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sizeId,n.merchant){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Size Id is required");case 5:return e.next=7,w(F,r);case 7:if(a=e.sent){e.next=10;break}throw new Error("Could not find the category");case 10:return e.next=12,b(H,a.storeId,n.merchant.id);case 12:if(e.sent){e.next=15;break}throw new Error("Unauthaurized operation");case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))()},colors:function(e,t,n){return s(o.mark((function e(){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.storeId){e.next=3;break}throw new Error("Billboard id is required.");case 3:if(r=W.findAll({where:{storeId:n}})){e.next=6;break}throw new Error("This billboard has no categories yet");case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))()},color:function(e,t,n){return s(o.mark((function e(){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.colorId,n.merchant){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Size Id is required");case 5:return e.next=7,E(W,r);case 7:if(a=e.sent){e.next=10;break}throw new Error("Could not find the category");case 10:return e.next=12,b(H,a.storeId,n.merchant.id);case 12:if(e.sent){e.next=15;break}throw new Error("Unauthaurized operation");case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))()},products:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,c,u,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,a=t.categoryId,s=t.sizeId,i=t.colorId,c=t.isFeatured,t.isArchived,n.merchant,u={},r&&(u.storeId=r),a&&(u.categoryId=a),s&&(u.sizeId=s),i&&(u.colorId=i),c&&(u.isFeatured=c),d=_.findAll({where:u})){e.next=11;break}throw new Error("This billboard has no categories yet");case 11:return e.abrupt("return",d);case 12:case"end":return e.stop()}}),e)})))()},productsIds:function(e,t,n){return s(o.mark((function e(){var n,r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.storeId,r=t.productIds,console.log("Product ids<<<<<<<".bgGreen,r),a={},n&&(a.storeId=n),s=_.findAll({where:{id:r,storeId:n}})){e.next=7;break}throw new Error("This billboard has no categories yet");case 7:return e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))()},productsWithVariants:function(e,t,n){return s(o.mark((function e(){var n,r,a,s,i,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.storeId,r=t.categoryId,a=t.variantId,s=t.isFeatured,t.isArchived,i={},n&&(i.storeId=n),r&&(i.categoryId=r),a&&(i.variantId=a),s&&(i.isFeatured=s),c=_.findAll({where:i,include:[{association:"prodVariations",include:[{association:"prodVarOptions"}]},{association:"prodCombinations",include:[{association:"variantImage"}]}]})){e.next=9;break}throw new Error("This store has no products yet");case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))()},product:function(e,t,n){return s(o.mark((function e(){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.productId){e.next=3;break}throw new Error("Product Id is required");case 3:return e.next=5,_.findOne({where:{id:n},include:[{as:"images",model:K},{association:"prodVariations",include:[{association:"prodVarOptions"}]},{association:"prodCombinations",include:[{association:"variantImage"}]}]});case 5:if(r=e.sent){e.next=8;break}throw new Error("Could not find the product");case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))()},allProducts:function(e,t,n){return s(o.mark((function e(){var t,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.next=3,n.merchant;case 3:if(r=e.sent){e.next=6;break}throw new Error("Make sure you are logged in to access your products");case 6:return e.next=8,H.findAll({where:{merchantId:r.id},include:{model:_}});case 8:if(t=e.sent){e.next=11;break}throw new Error("Add stores to view them here");case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))()},orders:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,n.merchant){e.next=3;break}throw new Error("Unauthenticated please make sure you are logged in.");case 3:return e.next=5,b(H,r,n.merchant.id);case 5:if(a=e.sent){e.next=8;break}throw new Error("Unauthorized operation.");case 8:return s=ce.findAll({where:{storeId:a.id},include:[{association:"customerOrder"},{association:"orderItems",include:{association:"orderProduct"}}]}),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})))()},templateSchedules:function(e,t,n){return s(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=me.findAll({where:{type:"bulkTemplate",timestamp:a({},m.lte,new Date),status:"PENDING"},include:[{association:"bulkTempTask"},{association:"merchantsTasks"}]}),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})))()}},RootMutation:{addCustomer:function(e,r,a){return s(o.mark((function e(){var i,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.customer,e.next=3,n.findOne({where:{id:a.merchant.id}});case 3:return d=e.sent,e.next=6,t.findOne({where:{phone_number:i.phone_number,merchantId:d.id}});case 6:if(!e.sent){e.next=12;break}return e.next=10,t.update(c({},i),{where:{phone_number:i.phone_number,merchantId:d.id}}).then((function(e){return u.log({level:"info",message:"customer updated"}),e}));case 10:e.next=15;break;case 12:return e.next=14,t.create(c({},i)).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.setMerchant(d.id)]);case 2:return u.log({level:"info",message:"Customer was created"}),e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)})))()},updateCustomer:function(e,n,r){return s(o.mark((function e(){var a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.customerId,s=n.payload,r.merchant){e.next=3;break}throw new Error("Unauthenticated please make sure you are logged in");case 3:if(a){e.next=5;break}throw new Error("Unathorized operation customer Id and the new names is required");case 5:return e.next=7,N(t,a,r.merchant.id);case 7:if(i=e.sent){e.next=10;break}throw new Error("Unathorized operation could not find the customer");case 10:return e.prev=10,e.next=13,t.update(c(c({},i),{},{first_name:s.first_name,last_name:s.last_name,phone_number:s.phone_number}),{where:{id:parseInt(a),merchantId:r.merchant.id},returning:!0,plain:!0}).then((function(e){return e[1]}));case 13:e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),"not_unique"!==e.t0.validatorKey){e.next=20;break}throw new Error("A customer of the given phone ".concat(s.name," already exists"));case 20:u.log({level:"error",message:"update customer for ".concat(r.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 21:return e.abrupt("return",i);case 22:case"end":return e.stop()}}),e,null,[[10,16]])})))()},addChat:function(e,t,n){return s(o.mark((function e(){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.chat,e.next=3,i.findOne({where:{merchantId:n.merchant.id,customerId:r.customer}});case 3:if(!e.sent){e.next=9;break}return e.next=7,i.update(c({},r),{where:{merchantId:n.merchant.id,customerId:r.customer}}).then((function(e){return u.log({level:"info",message:"Updated an existing chat"}),e}));case 7:e.next=12;break;case 9:return e.next=11,i.create().then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setCustomer(r.customer),t.setMerchant(n.merchant)]).then((function(){return u.log({level:"info",message:"Chat was created"}),U.publish("chatAdded",{chatAdded:t,merchantId:r.merchantId}),t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))()},addTextMessage:function(e,r,a){return s(o.mark((function e(){var d,l,p,m,h,f,g,v,b,x,y,w,E;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=r.message,l=r.participants,p=r.customerId,m=r.template,h=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:l,message:d,context:a,customerId:p,template:m,Message:I,contextMessage:h});case 3:return f=e.sent,g=f.customer,v=f.merchant,b=f.chat,x=f.addNewChat,y=f.messageId,w=f.contextedMessage,console.log("THE CHAT ITSELF",b),e.next=13,I.create(c(c({},d.message),{},y?{text:d.text,messageId:y,hasContext:!!w,contextId:w?w.id:null}:{text:d.text,hasContext:!!w,contextId:w?w.id:null}),{include:["text"]}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(b.id),t.setMerchant(v.id),t.setCustomer(g.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===x&&U.publish("chatAdded",{chatAdded:b,merchantId:b.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),u.log({level:"info",message:"Message was created ".concat((new Date).toDateString())}),e.next=5,i.update(c(c({},b),{},{createdAt:b.createdAt}),{where:{merchantId:v.id,customerId:g.id},silent:!1}).then((function(e){return u.log({level:"info",message:"chat updated"}),e}));case 5:return e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:return E=e.sent,console.log("MESSAGE TO RETURN",E),e.abrupt("return",E);case 16:case"end":return e.stop()}}),e)})))()},addImageMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y,w;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.template,l=r.customerId,p=r.participants,m=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:p,message:u,context:a,customerId:l,template:d,Message:I,contextMessage:m});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,y=h.contextedMessage,e.next=12,I.create(c(c({},u.message),{},x?{image:u.image,messageId:x,hasContext:!!y,contextId:y?y.id:null}:{image:u.image,hasContext:!!y,contextId:y?y.id:null}),{include:["image"]}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:return w=e.sent,console.log(w),e.abrupt("return",w);case 15:case"end":return e.stop()}}),e)})))()},addDocumentMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y,w;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.template,l=r.customerId,p=r.participants,m=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:p,message:u,context:a,customerId:l,template:d,Message:I,contextMessage:m});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,y=h.contextedMessage,e.next=12,I.create(c(c({},u.message),{},x?{document:u.document,messageId:x,hasContext:!!y,contextId:y?y.id:null}:{document:u.document,hasContext:!!y,contextId:y?y.id:null}),{include:["document"]}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:return w=e.sent,e.abrupt("return",w);case 14:case"end":return e.stop()}}),e)})))()},addVideoMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y,w;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.template,l=r.customerId,p=r.participants,m=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:p,message:u,context:a,customerId:l,template:d,Message:I,contextMessage:m});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,y=h.contextedMessage,e.next=12,I.create(c(c({},u.message),{},x?{video:u.video,messageId:x,hasContext:!!y,contextId:y?y.id:null}:{video:u.video,hasContext:!!y,contextId:y?y.id:null}),{include:["video"]}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:return w=e.sent,e.abrupt("return",w);case 14:case"end":return e.stop()}}),e)})))()},addInteractiveButtonMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.customerId,l=r.template,p=r.participants,m=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:p,message:u,context:a,customerId:d,template:l,Message:I,contextMessage:m});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,h.contextedMessage,e.next=12,I.create(c(c({},u.message),{},x?{interactive:u.interactive,messageId:x}:{interactive:u.interactive}),{include:{association:"interactive",include:{association:"button",include:["btnImageHead","buttons","btnTextHead"]}}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id),t.interactive.button.setProduct(t.interactive.button.productId)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:return y=e.sent,e.abrupt("return",y);case 14:case"end":return e.stop()}}),e)})))()},addInteractiveTemplateMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.customerId,l=r.template,p=r.participants,m=r.contextMessage,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:p,message:u,context:a,customerId:d,template:l,Message:I,contextMessage:m});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,h.contextedMessage,console.log("THE MESSAGE ID",x),e.next=13,I.create(c(c({},u.message),{},x?{interactive:u.interactive,messageId:x}:{interactive:u.interactive}),{include:{association:"interactive",include:{association:"template",include:["tempImageHead","buttons","tempTextHead"]}}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:return y=e.sent,e.abrupt("return",y);case 15:case"end":return e.stop()}}),e)})))()},addInteractiveListMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.customerId,l=r.participants,p=r.contextMessage,m=r.template,e.next=3,L({Merchant:n,Customer:t,Chat:i,participants:l,message:u,context:a,customerId:d,template:m,Message:I,contextMessage:p});case 3:return h=e.sent,f=h.customer,g=h.merchant,v=h.chat,b=h.addNewChat,x=h.messageId,h.contextedMessage,e.next=12,I.create(c(c({},u.message),{},x?{interactive:u.interactive,messageId:x}:{interactive:u.interactive}),{include:{association:"interactive",include:{association:"list",include:[{model:ue,as:"listTextHead"},{model:ae,as:"sections",include:["rows"]}]}}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(">>>>>>>>>".bgMagenta,t.interactive.button),e.abrupt("return",Promise.all([t.setChat(v.id),t.setMerchant(g.id),t.setCustomer(f.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===b&&U.publish("chatAdded",{chatAdded:v,merchantId:v.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},v),{},{createdAt:v.createdAt}),{where:{merchantId:g.id,customerId:f.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:return y=e.sent,e.abrupt("return",y);case 14:case"end":return e.stop()}}),e)})))()},addButtonRepliedMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.participants,l=r.contextMessage,console.log("CONTEXT MESSAGE",l),e.next=4,L({Merchant:n,Customer:t,Chat:i,participants:d,message:u,context:a,Message:I,contextMessage:l,InteractiveMessage:Z,InteractiveButton:ee});case 4:return p=e.sent,m=p.customer,h=p.merchant,f=p.chat,g=p.addNewChat,v=p.messageId,b=p.contextedMessage,u.mesBtnReply.interactiveButtonId=b.interactive.button.id,e.next=14,I.create(c(c({},u.message),{},v?{mesBtnReply:u.mesBtnReply,messageId:v,hasContext:!!b,contextId:b?b.id:null}:{mesBtnReply:u.mesBtnReply,hasContext:!!b,contextId:b?b.id:null}),{include:{association:"mesBtnReply"}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("THIS FUNCTION",t.mesBtnReply),e.abrupt("return",Promise.all([t.setChat(f.id),t.setMerchant(h.id),t.setCustomer(m.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===g&&U.publish("chatAdded",{chatAdded:f,merchantId:f.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},f),{},{createdAt:f.createdAt}),{where:{merchantId:h.id,customerId:m.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:return x=e.sent,b.isAd&&$({Ad:de,merchantId:h.id,adId:b.adId}),e.abrupt("return",x);case 17:case"end":return e.stop()}}),e)})))()},addTemplateRepliedMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.message,d=r.participants,l=r.contextMessage,console.log("CONTEXT MESSAGE",l),e.next=4,L({Merchant:n,Customer:t,Chat:i,participants:d,message:u,context:a,Message:I,contextMessage:l,InteractiveMessage:Z,InteractiveTemplate:te});case 4:return p=e.sent,m=p.customer,h=p.merchant,f=p.chat,g=p.addNewChat,v=p.messageId,b=p.contextedMessage,u.mesTempReply.interactiveTemplateId=null==b?void 0:b.interactive.template.id,e.next=14,I.create(c(c({},u.message),{},v?{mesTempReply:u.mesTempReply,messageId:v,hasContext:!!b,contextId:b?b.id:null}:{mesTempReply:u.mesTempReply,hasContext:!!b,contextId:b?b.id:null}),{include:{association:"mesTempReply"}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("THIS FUNCTION",t.mesTempReply),e.abrupt("return",Promise.all([t.setChat(f.id),t.setMerchant(h.id),t.setCustomer(m.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===g&&U.publish("chatAdded",{chatAdded:f,merchantId:f.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},f),{},{createdAt:f.createdAt}),{where:{merchantId:h.id,customerId:m.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:if(x=e.sent,!b.isAd){e.next=18;break}return e.next=18,$({Ad:de,merchantId:h.id,adId:b.adId,MarketingResponse:pe,response:{customerId:m.id,messageId:x.id,productId:null==b||null===(y=b.interactive)||void 0===y||null===(y=y.template)||void 0===y?void 0:y.productId}});case 18:return e.abrupt("return",x);case 19:case"end":return e.stop()}}),e)})))()},addListRepliedMessage:function(e,r,a){return s(o.mark((function e(){var u,d,l,p,m,h,f,g,v,b,x,y,w,E,T;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=r.message,m=r.participants,h=r.contextMessage,console.log("CONTEXT MESSAGE",h),e.next=4,L({Merchant:n,Customer:t,Chat:i,participants:m,message:p,context:a,Message:I,contextMessage:h,InteractiveMessage:Z,InteractiveList:ne,ListSection:ae});case 4:return f=e.sent,g=f.customer,v=f.merchant,b=f.chat,x=f.addNewChat,y=f.messageId,w=f.contextedMessage,console.log("the messge id>>>>>>>>>>>>>>>".bgBlue,y),console.log("the contexted messge id>>>>>>>>>>>>>>>".bgBlue,null==w||null===(u=w.interactive)||void 0===u||null===(u=u.list)||void 0===u?void 0:u.sections),console.log("the contexted row id>>>>>>>>>>>>>>>".bgBlue,null==w||null===(d=w.interactive)||void 0===d||null===(d=d.list)||void 0===d?void 0:d.sections[0].rows[0].buttonId),E=void 0,null==w||null===(l=w.interactive)||void 0===l||null===(l=l.list)||void 0===l||null===(l=l.sections)||void 0===l||l.every((function(e){var t;return null==e||null===(t=e.rows)||void 0===t||t.every((function(e){return console.log("buttonid",null==e?void 0:e.buttonId,p.mesListReply.buttonId),(null==e?void 0:e.buttonId)!==p.mesListReply.buttonId||(E=null==e?void 0:e.id,!1)})),!E})),console.log("\n\n ROW ID",E),console.log("the new message to add>>".bgBlue,p.mesListReply),p.mesListReply.listRowButtonId=E,console.log("the message id>>>".bgBlue,p),console.log("the btn reply>>>>>>>".bgBlue,p.mesListReply),e.next=23,I.create(c(c({},p.message),{},y?{mesListReply:p.mesListReply,messageId:y,hasContext:!!w,contextId:w?w.id:null}:{mesListReply:p.mesListReply,hasContext:!!w,contextId:w?w.id:null}),{include:{association:"mesListReply"}}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("THIS FUNCTION",t.mesBtnReply),e.abrupt("return",Promise.all([t.setChat(b.id),t.setMerchant(v.id),t.setCustomer(g.id)]).then(s(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0===x&&U.publish("chatAdded",{chatAdded:b,merchantId:b.merchantId}),U.publish("messageAdded",{messageAdded:{message:t},chatId:t.chatId}),e.next=4,i.update(c(c({},b),{},{createdAt:b.createdAt}),{where:{merchantId:v.id,customerId:g.id},silent:!1}).then((function(e){return e}));case 4:return e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 23:return T=e.sent,w.isAd&&$({Ad:de,merchantId:v.id,adId:w.adId}),e.abrupt("return",T);case 26:case"end":return e.stop()}}),e)})))()},addTemplateMesBulk:function(e,t,n){return s(o.mark((function e(){var r,a,l,p,m,h,f,g,v,b,x,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.message,a=t.selectedCustomers,l=t.template,console.log("for bulking",a,r,l),p=n.merchant,m=!1,h=null,p){e.next=7;break}throw new Error("Unauthenticated you need to be logged in!");case 7:return f=JSON.parse(a),g=JSON.parse(l),e.next=11,p.getSetting();case 11:if(v=(v=e.sent).dataValues){e.next=15;break}throw new Error("We could not find you Whatsapp business Setting make sure you add the settings before sending any message.");case 15:return b=void 0,x=void 0,e.prev=17,e.next=20,le.create({name:g.template.name,productId:null===(y=r.interactive.template)||void 0===y?void 0:y.productId}).then((function(e){return e.setMerchant(p.id),e}));case 20:if(!(b=e.sent)){e.next=27;break}return e.next=24,de.create().then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.setMerchant(p.id),t.setAdTemplate(b.id)]);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 24:if(x=e.sent){e.next=27;break}throw new Error("An error occured while creating your marketing campaign please try again later or contact us");case 27:e.next=34;break;case 29:throw e.prev=29,e.t0=e.catch(17),console.log(e.t0),u.log({level:"error",message:"[ERROR CREATING AD FOR MERCHANT], ".concat(p.id)}),new Error("An error occured while creating your marketing campaign please try again later or contact us");case 34:f.forEach(function(){var e=s(o.mark((function e(t){var n,a,l,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("the number>>>>>>>>>>>".bgGreen,t.phone_number),e.prev=1,g.to=t.phone_number,e.next=5,d(g,v);case 5:if(n=e.sent,!(a=n.data)){e.next=29;break}return h=a.messages[0].id,e.prev=9,e.next=12,P(i,t.id,p.id);case 12:if(l=e.sent){e.next=18;break}return e.next=16,G(i,t.id,p.id);case 16:l=e.sent,m=!0;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),u.log({level:"error",message:"Could not create chat before sending bulk message for ".concat((t.id,p.id))});case 23:return e.next=25,I.create(c(c({},r.message),{},h?{chatId:l.id,interactive:r.interactive,messageId:h,isAd:!0,adId:x.id}:{chatId:l.id,interactive:r.interactive,isAd:!0,adId:x.id}),{include:{association:"interactive",include:{association:"template",include:["tempImageHead","buttons","tempTextHead"]}}}).then(function(){var e=s(o.mark((function e(n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([n.setChat(l.id),n.setMerchant(p.id),n.setCustomer(t.id)]).then(s(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===m&&U.publish("chatAdded",{chatAdded:l,merchantId:l.merchantId}),U.publish("messageAdded",{messageAdded:{message:n},chatId:n.chatId}),null!==(t=b)&&void 0!==t&&t.messageId){e.next=5;break}return e.next=5,le.update(c(c({},b),{},{messageId:n.id}),{where:{id:b.id}});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 25:return f=e.sent,e.abrupt("return",f);case 29:return e.next=31,de.update(c(c({},x),{},{failed:null!==x.failed?x.failed+=1:1}),{where:{id:x.id},silent:!1});case 31:e.sent;case 32:e.next=41;break;case 34:return e.prev=34,e.t1=e.catch(1),u.log({level:"error",message:"[ERROR SENDING MESSAGE TO CUSTOMER] for ".concat(p.id," bulk message")}),console.log(e.t1),e.next=40,de.update(c(c({},x),{},{failed:null!==x.failed?x.failed+=1:1}),{where:{id:x.id},returning:!0,plain:!0}).then((function(e){return e[1]}));case 40:x=e.sent;case 41:case"end":return e.stop()}}),e,null,[[1,34],[9,20]])})));return function(t){return e.apply(this,arguments)}}());case 35:case"end":return e.stop()}}),e,null,[[17,29]])})))()},addSetting:function(e,t,n){return s(o.mark((function e(){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.setting,a=n.merchant){e.next=4;break}throw new Error("not_allowed");case 4:return r.callBack_url="".concat(process.env.WEBHOOK_BASE_URL,"/incoming?username=").concat(a.username),console.log(">>>>>>>>>>>>>>>>>>>>>>>>ueue",r),e.next=8,v.findOne({where:{merchantId:a.id}});case 8:if(!e.sent){e.next=14;break}return e.next=12,v.update(c({},r),{where:{merchantId:a.id}}).then((function(e){return u.log({level:"info",message:"setting updated"}),e}));case 12:e.next=15;break;case 14:return e.abrupt("return",v.create(c({},r)).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Promise.all([t.setMerchant(a.id)]),u.log({level:"info",message:"Setting created"}),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:case"end":return e.stop()}}),e)})))()},addStore:function(e,t,n){return s(o.mark((function e(){var r,a,i,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.store,a=n.merchant,console.log("The store to be added",r),!a){e.next=13;break}return e.next=6,H.findOne({where:{name:r.name,merchantId:a.id}});case 6:if(!(i=e.sent)){e.next=9;break}throw new Error('Store of name "'.concat(i.name,'" already exists. Use a different name to create a new store'));case 9:return e.next=11,H.create(c({},r)).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([t.setMerchant(a.id)]).then((function(){return u.log({level:"info",message:"Store of merchant ".concat(a.id)}),t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:return d=e.sent,e.abrupt("return",d);case 13:case"end":return e.stop()}}),e)})))()},updateChatStatus:function(e,r,d){return s(o.mark((function e(){var s,d,l,p,m,h,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.participants,d=r.payload,l=null,p=null,m=null,h=null,e.prev=5,e.next=8,n.findOne({where:{username:s.mer_username}});case 8:return l=e.sent,e.next=11,t.findOne({where:{phone_number:s.customer.phone_number,merchantId:l.id}});case 11:if((p=e.sent)&&l){e.next=16;break}u.log({level:"error",message:'"Could not find merchant or customer" '.concat(s.mer_username," ").concat(s.customer.phone_number,"} ")}),e.next=49;break;case 16:return console.log("IN HERE UPDATING MESSAGE".bgCyan,s,d),e.next=19,I.findOne({where:{merchantId:parseInt(l.id),customerId:parseInt(p.id),messageId:d.messageId}});case 19:if(m=e.sent,console.log("MESSAGE FOUND".bgMagenta,m),!m){e.next=42;break}return e.next=24,I.update(c(c({},m),{},{status:"read"===m.status?"read":"delivered"===m.status?"delivered":d.status}),{where:{id:m.id},silent:!1});case 24:if(0!==e.sent[0]){e.next=30;break}return u.log({level:"error",message:"Update failed for message of ".concat(l.id," and customer ").concat(p.id)}),e.abrupt("return");case 30:return e.next=32,I.findOne({where:{id:m.id,merchantId:l.id,customerId:p.id}});case 32:m=e.sent;case 33:if(U.publish("messageAdded",{messageAdded:{message:m},chatId:m.chatId}),!m.isAd){e.next=42;break}return e.next=37,B(de,l.id,m.adId);case 37:return f=e.sent,console.log("updating marketing id".bgBlue,f),e.next=41,de.update(c(c({},f),{},a({},m.status,null!==f["".concat(m.status)]?f["".concat(m.status)]+=1:1)),{where:{id:f.id},silent:!1});case 41:e.sent;case 42:return e.next=44,P(i,p.id,l.id);case 44:if(!(h=e.sent)||!d.conversationId){e.next=49;break}return e.next=48,i.update(c(c({},h),{},{status:"opened",conversationId:d.conversationId}),{where:{merchantId:l.id,customerId:p.id},silent:!1});case 48:h=e.sent;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(5),console.log("[AN ERROR WHILE UPDATING MESSAGE]",e.t0);case 54:case"end":return e.stop()}}),e,null,[[5,51]])})))()},updateMessageStatus:function(e,t,n){return s(o.mark((function e(){var r,a,i,l,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,a=t.messageId,!(i=n.merchant)){e.next=23;break}return e.prev=3,l=!1,e.next=7,I.findOne({where:{id:r,messageId:a}});case 7:if(!(p=e.sent)||"read"===p.status){e.next=18;break}return e.next=11,I.update(c(c({},p),{},{status:"read"}),{where:{id:r,messageId:a},silent:!1});case 11:return result=e.sent,l=!0,0===result[0]&&u.log({level:"error",message:'"updating message failed" "'.concat(p.merchantId,'"')}),e.next=16,I.findOne({where:{id:p.id},include:[{model:Y,as:"text"},{model:X,as:"image"}]}).then(function(){var e=s(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==l){e.next=10;break}return e.next=3,i.getSetting();case 3:return n=(n=e.sent).dataValues,(r=q.read).message_id=a,e.next=9,d(r,n);case 9:e.sent;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 16:return p=e.sent,e.abrupt("return",p);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),console.log("[AN ERROR WHILE UPDATING MESSAGE]");case 23:case"end":return e.stop()}}),e,null,[[3,20]])})))()},updateStore:function(e,t,n){return s(o.mark((function e(){var r,a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthenticated please make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Unathorized operation store Id and the new name required");case 5:return e.next=7,b(H,r,n.merchant.id);case 7:if(s=e.sent){e.next=10;break}throw new Error("Unathorized operation could not find the store");case 10:return e.next=12,S(H,a.name,n.merchant.id);case 12:if(!(i=e.sent)){e.next=16;break}if(s.id===i.id){e.next=16;break}throw new Error('Store of name "'.concat(a.name,'" already exists.'));case 16:return e.prev=16,e.next=19,H.update(c(c({},s),{},{name:a.name}),{where:{id:parseInt(r),merchantId:n.merchant.id}});case 19:if(0!==e.sent[0]){e.next=22;break}throw new Error("Update failed");case 22:return e.next=24,b(H,r,n.merchant.id);case 24:s=e.sent,e.next=33;break;case 27:if(e.prev=27,e.t0=e.catch(16),console.log("[UPDATING STORE ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=32;break}throw new Error("A store of the give name ".concat(a.name," already exists"));case 32:u.log({level:"error",message:"update store for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 33:return e.abrupt("return",s);case 34:case"end":return e.stop()}}),e,null,[[16,27]])})))()},deleteStore:function(e,t,n){return s(o.mark((function e(){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:return e.next=5,b(H,r,n.merchant.id);case 5:if(e.sent){e.next=8;break}throw new Error("Unauthorized operation");case 8:return e.prev=8,e.next=11,H.destroy({where:{id:r,merchantId:n.merchant.id}});case 11:e.sent,e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(8),console.log(e.t0),e.abrupt("return",!1);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,null,[[8,14]])})))()},addBillboard:function(e,t,n){return s(o.mark((function e(){var r,a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.billboard,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to create a billboard");case 4:return e.next=6,b(H,r.storeId,n.merchant.id);case 6:if(s=e.sent){e.next=9;break}throw new Error("Unauthorized operation");case 9:return e.next=11,j.findOne({where:{storeId:s.id,label:r.label}});case 11:if(!e.sent){e.next=14;break}throw new Error("Billboard of name ".concat(r.label," already exists."));case 14:return e.prev=14,e.next=17,j.create(c({},r));case 17:return i=e.sent,e.abrupt("return",i);case 21:throw e.prev=21,e.t0=e.catch(14),u.log({level:"error",message:"An error occured while creating billboard for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),new Error("Could not create a billboard try again later",e.t0);case 25:case"end":return e.stop()}}),e,null,[[14,21]])})))()},updateBillboard:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.billboardId,a=t.payload,console.log("UPDATING Billboard",r,a),n.merchant){e.next=4;break}throw new Error("Unauthorized make sure you are logged in.");case 4:if(r){e.next=6;break}throw new Error("Billboard id is required");case 6:if(a.storeId){e.next=8;break}throw new Error("Unauthorized operation");case 8:return e.next=10,b(H,a.storeId,n.merchant.id);case 10:if(s=e.sent){e.next=13;break}throw new Error("Unauthorized operation");case 13:return e.next=15,j.findOne({where:{id:r,storeId:s.id}});case 15:if(i=e.sent){e.next=18;break}throw new Error("Could not find the billboard");case 18:return e.next=20,R(j,a.label,s.id);case 20:if(!(d=e.sent)){e.next=24;break}if(i.id===d.id){e.next=24;break}throw new Error('Billboard of name "'.concat(a.label,'" already exists.'));case 24:if(e.prev=24,a.label){e.next=27;break}throw new Error("Label is required");case 27:if(a.imageUrl){e.next=29;break}throw new Error("Image Url is required");case 29:return e.next=31,j.update(c(c({},i),{},{label:a.label,imageUrl:a.imageUrl}),{where:{id:parseInt(i.id),storeId:i.storeId}});case 31:if(0!==e.sent[0]){e.next=34;break}throw new Error("Update failed.");case 34:return e.next=36,x(j,r);case 36:return l=e.sent,e.abrupt("return",l);case 40:if(e.prev=40,e.t0=e.catch(24),console.log("[UPDATING BILLBOARD ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=45;break}throw new Error("A billboard of the give name ".concat(a.name," already exists"));case 45:u.log({level:"error",message:"update store for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 46:case"end":return e.stop()}}),e,null,[[24,40]])})))()},deleteBillboard:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.billboardId,a=t.storeId,console.log("DELETING BILLBOARD",r,a),n.merchant.id){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in");case 4:if(r){e.next=6;break}throw new Error("Billboard ID is requreid");case 6:if(a){e.next=8;break}throw new Error("Unauthorized operation store Id does not match");case 8:return e.next=10,b(H,a,n.merchant.id);case 10:if(s=e.sent){e.next=13;break}throw new Error("Unauthaurized operation");case 13:return e.next=15,j.findOne({where:{id:r,storeId:s.id}});case 15:if(e.sent){e.next=18;break}throw new Error("Could not find the billboard.");case 18:return e.prev=18,e.next=21,j.destroy({where:{id:r}});case 21:e.sent,e.next=28;break;case 24:return e.prev=24,e.t0=e.catch(18),console.log(e.t0),e.abrupt("return",!1);case 28:return e.abrupt("return",!0);case 29:case"end":return e.stop()}}),e,null,[[18,24]])})))()},addCategory:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.category,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to add a category");case 4:if(r.name){e.next=8;break}throw new Error("Category name is required");case 8:if(r.billboardId){e.next=10;break}throw new Error("Billboard Id is required");case 10:return e.next=12,x(j,r.billboardId);case 12:if(s=e.sent){e.next=15;break}throw new Error("Could not find the billboard");case 15:return e.next=17,b(H,s.storeId,a.id);case 17:if(i=e.sent){e.next=20;break}throw new Error("Unauthorized operation");case 20:return e.next=22,V.findOne({where:{name:r.name,billboardId:r.billboardId,storeId:i.id}});case 22:if(!(d=e.sent)){e.next=25;break}throw new Error("Category of name ".concat(d.name," already exists."));case 25:return e.prev=25,e.next=28,V.create(c({},r)).then((function(e){return e.setStore(i.id),e}));case 28:return l=e.sent,e.abrupt("return",l);case 32:throw e.prev=32,e.t0=e.catch(25),u.log({level:"error",message:"An error occured while creating category for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),new Error("Could not create a category try again later",e.t0);case 36:case"end":return e.stop()}}),e,null,[[25,32]])})))()},updateCategory:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.categoryId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:if(r){e.next=7;break}throw new Error("Cateory id is required.");case 7:if(a.name){e.next=11;break}throw new Error("A name is required");case 11:if(a.billboardId){e.next=13;break}throw new Error("Billboard id is required");case 13:return e.next=15,V.findOne({where:{id:r}});case 15:if(s=e.sent){e.next=18;break}throw new Error("Could not find the category.");case 18:return e.next=20,x(j,a.billboardId);case 20:if(i=e.sent){e.next=23;break}throw new Error("Could not find billboard.");case 23:return e.next=25,b(H,i.storeId,n.merchant.id);case 25:if(e.sent){e.next=28;break}throw new Error("Unauthorized operation.");case 28:return e.next=30,M(V,a.name,i.id);case 30:if(!(d=e.sent)){e.next=34;break}if(s.id===d.id){e.next=34;break}throw new Error('Category of name "'.concat(a.name,'" already exists for this store.'));case 34:return e.prev=34,e.next=37,V.update(c(c({},s),{},{name:a.name,billboardId:a.billboardId}),{where:{id:parseInt(r)}});case 37:if(0!==e.sent[0]){e.next=40;break}throw new Error("Update failed");case 40:return e.next=42,y(V,r);case 42:return l=e.sent,e.abrupt("return",l);case 46:if(e.prev=46,e.t0=e.catch(34),console.log("[UPDATING BILLBOARD ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=51;break}throw new Error("A category of the given name ".concat(a.name," already exists"));case 51:u.log({level:"error",message:"update store for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 52:case"end":return e.stop()}}),e,null,[[34,46]])})))()},deleteCategory:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.categoryId,a=t.storeId,console.log("DELETING BILLBOARD",r,a),n.merchant.id){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in");case 4:if(r){e.next=6;break}throw new Error("Category ID is requreid");case 6:if(a){e.next=8;break}throw new Error("Store Id id required");case 8:return e.next=10,b(H,a,n.merchant.id);case 10:if(s=e.sent){e.next=13;break}throw new Error("Unauthaurized operation");case 13:return e.prev=13,e.next=16,V.destroy({where:{id:r,storeId:s.id}});case 16:e.sent,e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(13),console.log(e.t0),e.abrupt("return",!1);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,null,[[13,19]])})))()},addSize:function(e,t,n){return s(o.mark((function e(){var r,a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.size,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to create a billboard");case 4:return e.next=6,b(H,r.storeId,n.merchant.id);case 6:if(s=e.sent){e.next=9;break}throw new Error("Unauthorized operation");case 9:return e.next=11,F.findOne({where:{storeId:s.id,name:r.name}});case 11:if(!e.sent){e.next=14;break}throw new Error("Size of name ".concat(r.name," already exists."));case 14:return e.prev=14,e.next=17,F.create(c({},r));case 17:return i=e.sent,e.abrupt("return",i);case 21:throw e.prev=21,e.t0=e.catch(14),u.log({level:"error",message:"An error occured while creating size for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),new Error("Could not create a new size try again late.r",e.t0);case 25:case"end":return e.stop()}}),e,null,[[14,21]])})))()},updateSize:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sizeId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:if(r){e.next=5;break}throw new Error("Billboard id is required");case 5:if(a.storeId){e.next=7;break}throw new Error("Store id is required");case 7:if(a.name){e.next=9;break}throw new Error("Name is required");case 9:if(a.value){e.next=11;break}throw new Error("Value is required");case 11:return e.next=13,b(H,a.storeId,n.merchant.id);case 13:if(s=e.sent){e.next=16;break}throw new Error("Unauthorized operation");case 16:return e.next=18,F.findOne({where:{id:r,storeId:s.id}});case 18:if(i=e.sent){e.next=21;break}throw new Error("Could not find the size");case 21:return e.next=23,C(F,a.name,s.id);case 23:if(!(d=e.sent)){e.next=27;break}if(i.id===d.id){e.next=27;break}throw new Error('Size of name "'.concat(a.name,'" already exists for this store.'));case 27:return e.prev=27,e.next=30,F.update(c(c({},i),{},{name:a.name,value:a.value}),{where:{id:parseInt(i.id),storeId:i.storeId}});case 30:if(0!==e.sent[0]){e.next=33;break}throw new Error("Update failed.");case 33:return e.next=35,w(F,r);case 35:return l=e.sent,e.abrupt("return",l);case 39:if(e.prev=39,e.t0=e.catch(27),console.log("[UPDATING Size ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=44;break}throw new Error("A soze of the give name ".concat(a.name," already exists"));case 44:u.log({level:"error",message:"update size for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 45:case"end":return e.stop()}}),e,null,[[27,39]])})))()},deleteSize:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sizeId,a=t.storeId,n.merchant.id){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Size ID is requreid");case 5:if(a){e.next=7;break}throw new Error("Store id is required");case 7:return e.next=9,b(H,a,n.merchant.id);case 9:if(s=e.sent){e.next=12;break}throw new Error("Unauthaurized operation");case 12:return e.next=14,F.findOne({where:{id:r,storeId:s.id}});case 14:if(e.sent){e.next=17;break}throw new Error("Could not find the size.");case 17:return e.prev=17,e.next=20,F.destroy({where:{id:r}});case 20:e.sent,e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(17),console.log(e.t0),e.abrupt("return","failed");case 27:return e.abrupt("return","success");case 28:case"end":return e.stop()}}),e,null,[[17,23]])})))()},addColor:function(e,t,n){return s(o.mark((function e(){var r,a,s,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.color,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to create a billboard");case 4:return e.next=6,b(H,r.storeId,n.merchant.id);case 6:if(s=e.sent){e.next=9;break}throw new Error("Unauthorized operation");case 9:return e.next=11,W.findOne({where:{storeId:s.id,name:r.name}});case 11:if(!e.sent){e.next=14;break}throw new Error("Color of name ".concat(r.name," already exists."));case 14:return e.prev=14,e.next=17,W.create(c({},r));case 17:return i=e.sent,e.abrupt("return",i);case 21:throw e.prev=21,e.t0=e.catch(14),u.log({level:"error",message:"An error occured while creating color for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),new Error("Could not create a new color try again late.r",e.t0);case 25:case"end":return e.stop()}}),e,null,[[14,21]])})))()},updateColor:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.colorId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:if(r){e.next=5;break}throw new Error("Billboard id is required");case 5:if(a.storeId){e.next=7;break}throw new Error("Store id is required");case 7:if(a.name){e.next=9;break}throw new Error("Name is required");case 9:if(a.value){e.next=11;break}throw new Error("Value is required");case 11:return e.next=13,b(H,a.storeId,n.merchant.id);case 13:if(s=e.sent){e.next=16;break}throw new Error("Unauthorized operation");case 16:return e.next=18,W.findOne({where:{id:r,storeId:s.id}});case 18:if(i=e.sent){e.next=21;break}throw new Error("Could not find the color");case 21:return e.next=23,O(W,a.name,s.id);case 23:if(!(d=e.sent)){e.next=27;break}if(i.id===d.id){e.next=27;break}throw new Error('Color of name "'.concat(a.name,'" already exists for this store.'));case 27:return e.prev=27,e.next=30,W.update(c(c({},i),{},{name:a.name,value:a.value}),{where:{id:parseInt(i.id),storeId:i.storeId}});case 30:if(0!==e.sent[0]){e.next=33;break}throw new Error("Update failed.");case 33:return e.next=35,E(W,r);case 35:return l=e.sent,e.abrupt("return",l);case 39:if(e.prev=39,e.t0=e.catch(27),console.log("[UPDATING Color ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=44;break}throw new Error("A soze of the give name ".concat(a.name," already exists"));case 44:u.log({level:"error",message:"update color for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 45:case"end":return e.stop()}}),e,null,[[27,39]])})))()},deleteColor:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.colorId,a=t.storeId,n.merchant.id){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Color ID is requreid");case 5:if(a){e.next=7;break}throw new Error("Store id is required");case 7:return e.next=9,b(H,a,n.merchant.id);case 9:if(s=e.sent){e.next=12;break}throw new Error("Unauthaurized operation");case 12:return e.next=14,W.findOne({where:{id:r,storeId:s.id}});case 14:if(e.sent){e.next=17;break}throw new Error("Could not find the color.");case 17:return e.prev=17,e.next=20,W.destroy({where:{id:r}});case 20:e.sent,e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(17),console.log(e.t0),e.abrupt("return","failed");case 27:return e.abrupt("return","success");case 28:case"end":return e.stop()}}),e,null,[[17,23]])})))()},addProduct:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.product,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to add a category");case 4:if(r.name){e.next=8;break}throw new Error("Product name is required");case 8:if(r.price){e.next=12;break}throw new Error("product price is required");case 12:if(r.categoryId){e.next=16;break}throw new Error("Product's category id is required");case 16:if(r.storeId){e.next=20;break}throw new Error("Product's store id is required");case 20:if(r.images&&r.images.length){e.next=22;break}throw new Error("Product images is required.");case 22:return e.next=24,b(H,r.storeId,a.id);case 24:if(s=e.sent){e.next=27;break}throw new Error("Unauthorized operation.");case 27:return e.next=29,_.findOne({where:{name:r.name,categoryId:r.categoryId,storeId:r.storeId}});case 29:if(!(i=e.sent)){e.next=32;break}throw new Error("Category of name ".concat(i.name," already exists."));case 32:return d=r.images.map((function(e){return c(c({},e),{},{storeId:r.storeId})})),e.prev=33,e.next=36,_.create(c(c({},r),{},{images:d}),{include:["images"]}).then((function(e){return e.setStore(s.id),e}));case 36:return l=e.sent,e.abrupt("return",l);case 40:throw e.prev=40,e.t0=e.catch(33),u.log({level:"error",message:"An error occured while creating product for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),console.log(e.t0),new Error("Could not create a product try again later",e.t0);case 45:case"end":return e.stop()}}),e,null,[[33,40]])})))()},updateProduct:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d,l,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.productId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:if(r){e.next=7;break}throw new Error("Product id is required.");case 7:if(a.name){e.next=11;break}throw new Error("A product name is required");case 11:if(a.storeId){e.next=15;break}throw new Error("Store id is required");case 15:if(a.categoryId){e.next=19;break}throw new Error("Category id is required");case 19:if(a.images&&a.images.length){e.next=21;break}throw new Error("Product images is required.");case 21:return e.next=23,T(_,r);case 23:if(s=e.sent){e.next=26;break}throw new Error("Could not find product.");case 26:return e.next=28,b(H,s.storeId,n.merchant.id);case 28:if(i=e.sent){e.next=31;break}throw new Error("Unauthorized operation.");case 31:return e.next=33,k(_,a.name,s.categoryId);case 33:if(!(d=e.sent)){e.next=37;break}if(s.id===d.id){e.next=37;break}throw new Error('Product of name "'.concat(a.name,'" already exists for this store.'));case 37:return e.next=39,K.destroy({where:{productId:r,storeId:a.storeId}});case 39:return e.prev=39,e.next=42,_.update(c(c({},s),{},{name:a.name,price:a.price,isFeatured:a.isFeatured,isArchived:a.isArchived,sizeId:a.sizeId,colorId:a.colorId,categoryId:a.categoryId,storeId:a.storeId}),{where:{id:parseInt(r)}},{include:["images"]});case 42:if(0!==e.sent[0]){e.next=45;break}throw new Error("Update failed");case 45:return e.next=47,T(_,r);case 47:return l=e.sent,e.next=50,a.images.map((function(e){return c(c({},e),{},{storeId:i.id,productId:l.id})}));case 50:return p=e.sent,e.next=53,K.bulkCreate(p);case 53:return e.sent,e.abrupt("return",l);case 57:if(e.prev=57,e.t0=e.catch(39),console.log("[UPDATING PRODUCT ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=62;break}throw new Error("A category of the given name ".concat(a.name," already exists"));case 62:u.log({level:"error",message:"update store for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 63:case"end":return e.stop()}}),e,null,[[39,57]])})))()},deleteProduct:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.productId,a=t.storeId,n.merchant.id){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Product ID is requreid");case 5:if(a){e.next=7;break}throw new Error("Store ID is required");case 7:return e.next=9,b(H,a,n.merchant.id);case 9:if(s=e.sent){e.next=12;break}throw new Error("Unauthaurized operation");case 12:return e.prev=12,e.next=15,_.destroy({where:{id:r,storeId:s.id}});case 15:e.sent,e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(12),console.log(e.t0),e.abrupt("return",!1);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,null,[[12,18]])})))()},addProductVariations:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.product,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to add a category");case 4:if(r.name){e.next=8;break}throw new Error("Product name is required");case 8:if(r.price){e.next=12;break}throw new Error("product price is required");case 12:if(r.categoryId){e.next=16;break}throw new Error("Product's category id is required");case 16:if(r.storeId){e.next=18;break}throw new Error("Product's store id is required");case 18:return e.next=20,b(H,r.storeId,a.id);case 20:if(s=e.sent){e.next=23;break}throw new Error("Unauthorized operation.");case 23:return e.next=25,_.findOne({where:{name:r.name,categoryId:r.categoryId,storeId:r.storeId}});case 25:if(!(i=e.sent)){e.next=28;break}throw new Error("Product of name ".concat(i.name," already exists."));case 28:return e.next=30,_.create(c({},r),{include:[{association:"images"},{association:"prodVariations",include:[{association:"prodVarOptions"}]},{association:"prodCombinations",include:[{association:"variantImage"}]}]}).then((function(e){return e.setStore(s.id),e}));case 30:return u=e.sent,e.abrupt("return",u);case 32:case"end":return e.stop()}}),e)})))()},updateProductVariation:function(e,t,n){return s(o.mark((function e(){var r,a,s,i,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.productId,a=t.payload,n.merchant){e.next=3;break}throw new Error("Unauthorized make sure you are logged in.");case 3:if(r){e.next=7;break}throw new Error("Product id is required.");case 7:if(a.name){e.next=11;break}throw new Error("A product name is required");case 11:if(a.storeId){e.next=15;break}throw new Error("Store id is required");case 15:if(a.categoryId){e.next=19;break}throw new Error("Category id is required");case 19:if(a.images&&a.images.length){e.next=21;break}throw new Error("Product images is required.");case 21:return e.next=23,T(_,r);case 23:if(s=e.sent){e.next=26;break}throw new Error("Could not find product.");case 26:return e.next=28,b(H,s.storeId,n.merchant.id);case 28:if(e.sent){e.next=31;break}throw new Error("Unauthorized operation.");case 31:return e.next=33,k(_,a.name,s.categoryId);case 33:if(!(i=e.sent)){e.next=37;break}if(s.id===i.id){e.next=37;break}throw new Error('Product of name "'.concat(a.name,'" already exists for this store.'));case 37:return e.next=39,K.destroy({where:{productId:r,storeId:a.storeId}});case 39:return e.prev=39,e.next=42,_.update(c(c({},s),{},{name:a.name,price:a.price,isFeatured:a.isFeatured,isArchived:a.isArchived,categoryId:a.categoryId,storeId:a.storeId,prodVariations:a.prodVariations,prodCombinations:a.prodCombinations}),{where:{id:parseInt(r)}},{include:[{association:"images"},{association:"prodVariations",include:[{association:"prodVarOptions"}]},{association:"prodCombinations",include:[{association:"variantImage"}]}]});case 42:if(0!==e.sent[0]){e.next=45;break}throw new Error("Update failed");case 45:return e.next=47,T(_,r);case 47:return d=e.sent,e.abrupt("return",d);case 51:if(e.prev=51,e.t0=e.catch(39),console.log("[UPDATING PRODUCT ERROR]",e.t0),"not_unique"!==e.t0.validatorKey){e.next=56;break}throw new Error("A category of the given name ".concat(a.name," already exists"));case 56:u.log({level:"error",message:"update store for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 57:case"end":return e.stop()}}),e,null,[[39,51]])})))()},addImage:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.image,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated make sure you are logged in to create a billboard");case 4:return e.next=6,b(H,r.storeId,n.merchant.id);case 6:if(e.sent){e.next=9;break}throw new Error("Unauthorized operation");case 9:return e.prev=9,e.next=12,K.create(c({},r));case 12:return s=e.sent,e.abrupt("return",s);case 16:throw e.prev=16,e.t0=e.catch(9),u.log({level:"error",message:"An error occured while creating image for ".concat(a.id," at ").concat((new Date).toLocaleDateString())}),new Error("Could not create a new image try again later",e.t0);case 20:case"end":return e.stop()}}),e,null,[[9,16]])})))()},deleteImage:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.imageId,a=t.storeId,n.merchant.id){e.next=3;break}throw new Error("Unauthenticated make sure you are logged in");case 3:if(r){e.next=5;break}throw new Error("Image ID is requreid");case 5:if(a){e.next=7;break}throw new Error("Store ID is required");case 7:return e.next=9,b(H,a,n.merchant.id);case 9:if(s=e.sent){e.next=12;break}throw new Error("Unauthaurized operation");case 12:return e.prev=12,e.next=15,K.destroy({where:{id:r,storeId:s.id}});case 15:e.sent,e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(12),console.log(e.t0),e.abrupt("return",!1);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,null,[[12,18]])})))()},addOrder:function(e,n,r){return s(o.mark((function e(){var r,a,s,i,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.order,a=n.storeId){e.next=3;break}throw new Error("Could not find the store.");case 3:return e.next=5,b(H,a);case 5:if(s=e.sent){e.next=8;break}throw new Error("Unauthorized operation");case 8:if(!r.phone_number){e.next=16;break}return e.next=11,A(t,r.phone_number,s.merchantId);case 11:if(i=e.sent){e.next=16;break}return e.next=15,D(t,{phone_number:r.phone_number},s.merchantId);case 15:i=e.sent;case 16:return e.next=18,ce.create(c(c({},r),{},{phone:i.phone_number,customerId:i.id,status:r.isPaid?"CONFIRMED":"PENDING",storeId:a}),{include:[{association:"orderItems",include:{association:"orderProduct"}}]}).then((function(e){var t=s.name.slice(0,10).replaceAll(/[^a-zA-Z0-9]/g,"")+"-".concat(e.id);return ce.update(c(c({},e),{},{orderID:t.toLowerCase()}),{where:{id:e.id},returning:!0,include:[{association:"orderItems",include:{association:"orderProduct"}}]}).then((function(t){return ce.findOne({where:{id:e.id},include:[{association:"orderItems",include:{association:"orderProduct"}}]})}))}));case 18:return u=e.sent,console.log("THE ADDED ORDER",u),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e)})))()},updateOrderCheckout:function(e,t,n){return s(o.mark((function e(){var r,a,i,d,l,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeId,a=t.orderId,i=t.payload,console.log("UPDATING Billboard",a,i,r),a){e.next=4;break}throw new Error("Order id is required");case 4:if(r){e.next=6;break}throw new Error("Unauthorized operation");case 6:return e.next=8,b(H,r);case 8:if(d=e.sent){e.next=11;break}throw new Error("Unauthorized operation");case 11:return e.next=13,ce.findOne({where:{id:a,storeId:d.id}});case 13:if(l=e.sent){e.next=16;break}throw new Error("Could not find the order");case 16:return e.prev=16,e.next=19,ce.update(c(c({},l),{},{isPaid:i.isPaid,address:i.address,phone:i.phone_number,status:i.isPaid?"CONFIRMED":"PENDING"}),{where:{id:parseInt(l.id),storeId:r},returning:!0,plain:!0},{include:["orderItems"]}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.findOne({where:{id:t[1].id},include:[{association:"customerOrder"},{association:"orderItems",include:{association:"orderProduct"}}]});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 19:return p=e.sent,console.log(p),e.abrupt("return",p);case 24:e.prev=24,e.t0=e.catch(16),u.log({level:"error",message:"update orderItesm for ".concat(n.merchant.id," failed ").concat((new Date).toLocaleDateString())});case 27:case"end":return e.stop()}}),e,null,[[16,24]])})))()},signupMerchant:function(e,t,r){return s(o.mark((function e(){var i,c,u,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.username,c=t.password,u=t.whatsapp_phone_number,d=t.email,e.abrupt("return",n.findAll({where:a({},m.or,[{whatsapp_phone_number:u},{username:i}]),raw:!0}).then(function(){var e=s(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=4;break}throw new Error("Username or phone number already in use");case 4:return e.abrupt("return",l.hash(c,10).then((function(e){return n.create({username:i,password:e,email:d,whatsapp_phone_number:u,activated:1}).then((function(e){var t=p.sign({username:i,id:e.id},z,{expiresIn:"1d"});return h(r,t),{token:t,merchant:e}}))})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))()},loginMerchant:function(e,t,r){return s(o.mark((function e(){var a,i;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.username,i=t.password,e.abrupt("return",n.findAll({where:{username:a},raw:!0}).then(function(){var e=s(o.mark((function e(t){var n,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.length){e.next=12;break}return n=t[0],e.next=4,l.compare(i,n.password);case 4:if(e.sent){e.next=7;break}throw new Error("Password or username does not match");case 7:return s=p.sign({username:a,id:n.id},z,{expiresIn:"1d"}),h(r,s),e.abrupt("return",{token:s,merchant:n});case 12:throw new Error("Error while logging you in we did not find the user");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))()},logoutMerchant:function(e,t,n){return h(n,logout=!0),{message:!0}},addBulkTemplateTask:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.schedule,a=n.merchant){e.next=4;break}throw new Error("Unauthenticated please make sure you are logged in.");case 4:if(r){e.next=6;break}throw new Error("An error occured. Could not add the schedule");case 6:return e.next=8,me.create(c(c({},r),{},{merchantId:a.id,timestamp:new Date(r.timestamp).getUTCDate(),bulkTempTask:r.bulkTempTask}),{include:{association:"bulkTempTask"}});case 8:return s=e.sent,console.log(s),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})))()},updateBulkTemplateTask:function(e,t,n){return s(o.mark((function e(){var r,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.taskId,a=t.merchantId,n.merchant){e.next=4;break}throw new Error("No authentication headers");case 4:return a||u.log({level:"error",message:"##################Could not find the merchant's ID while updating task##########"}),e.next=7,me.findOne({where:{id:r,merchantId:a}});case 7:return s=e.sent,e.prev=8,e.next=11,me.update(c(c({},s),{},{status:"EXECUTED"}),{where:{id:r,merchantId:a}});case 11:return e.abrupt("return","success");case 14:throw e.prev=14,e.t0=e.catch(8),u.log({level:"error",message:"Could not update {}"}),console.log(e.t0),new Error("Could not update Schedule task for ID ".concat(r));case 19:case"end":return e.stop()}}),e,null,[[8,14]])})))()}},RootSubscription:{messageAdded:{subscribe:g((function(){return U.asyncIterator(["messageAdded"])}),function(){var e=s(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.messageAdded.message.chatId===n.chatId);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},chatAdded:{subscribe:g((function(){return U.asyncIterator(["chatAdded"])}),function(){var e=s(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.chatAdded.merchantId===n.merchantId);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}});return he}},6854:(e,t,n)=>{n(3338).Date,e.exports=["#graqhql\n    scalar Date\n    # tell apollo server @auth can be used with queries, fields, and field definitions so that use it everywhere\n    directive @auth on QUERY | FIELD_DEFINITION | FIELD\n\n    type Merchant {\n        id: Int\n        business_name: String\n        username: String!\n        password: String\n        email: String\n        whatsapp_phone_number: String\n        customers: [Customer]\n        setting: Setting\n        products: [Product]\n        chats: [Chat]\n        stores: [Store]\n    }\n    type Customer {\n        id: Int!\n        whatsapp_name: String\n        phone_number: String!\n        first_name: String\n        last_name: String\n        createdAt: Date!\n        merchant: Merchant\n        customerOrder: [Order]\n    }\n    type Chat {\n        id: Int!\n        createdAt: Date\n        merchant: Merchant!\n        customer: Customer!\n        messages: [Message]!\n        lastMessage: Message\n        conversations:[Conversation]\n        status: String\n    }\n    type Conversation {\n        id: Int!\n        chat: Chat\n\n        conversationId:String\n        status: String\n        pricingModel: String\n        category: String\n        expiryDate: Date\n    }\n    type Message {\n        id: Int!\n        chat: Chat\n        type: String\n        isAd: Boolean\n        text: TextMessage\n        image: ImageMessage\n        video: VideoMessage\n        document: DocumentMessage\n        interactive: InteractiveMessage\n        mesBtnReply: ButtonRepliedAction\n        mesListReply: ListRepliedAction\n        mesTempReply: TemplateRepliedAction\n        messageAd: Ad\n        hasContext: Boolean\n        context: Message\n        contexts: [Message]\n        from_customer: Boolean\n        messageId: String\n        status: String\n        timestamp: Date\n        createdAt: Date\n    }\n    type TextMessage {\n        id: Int\n        body: String!\n    }\n    type ImageMessage{\n        id: Int!\n        imageId: String\n        caption: String\n        mimeType: String\n        sha256: String\n        url: String\n        AWfileId: String\n        AWbucketId: String\n        message: Message!\n    }\n    type VideoMessage{\n        id: Int!\n        videoId: String\n        caption: String\n        mimeType: String\n        sha256: String\n        url: String\n        message: Message!\n    }\n    type DocumentMessage{\n        id: Int!\n        documentId: String\n        caption: String\n        mimeType: String\n        sha256: String\n        filename: String\n        url: String\n        message: Message!\n    }\n    type InteractiveMessage {\n        id: Int!\n        message: Message!\n        type: String!\n        button: InteractiveButton\n        list: InteractiveList\n        template: InteractiveTemplate\n    }\n####################### INTERACTIVE BUTTON ############################################\n\n    type InteractiveButton {\n        id: Int!\n        interactiveMessage: InteractiveMessage!\n        header: String\n        btnImageHead: ImageHeader\n        btnTextHead: TextHeader\n        body: String\n        footer: String\n        action: String  # action you want the user to take\n        buttons: [ButtonReplyAction] # the actions the user can take\n        product: Product\n    }\n    type ButtonReplyAction {\n        id: Int!\n        button: InteractiveButton!\n        buttonId: String!\n        title: String!\n    }\n    type ButtonRepliedAction {\n        id: Int\n        buttonId: String\n        title: String\n\n        message: Message\n        buttonReply: InteractiveButton\n    }\n######################################INTERACTIVE LIST #################################\n    type InteractiveList {\n        id: Int!\n        header: String\n        body: String\n        footer: String\n        button: String # action you want the user to take a button to open the list to make order\n        \n        interactiveMessage: InteractiveMessage!\n        sections: [ListSection]\n        listReplys: ListRepliedAction\n        listTextHead: TextHeader\n    }\n    type ListSection {\n        title: String\n\n        interactiveList: InteractiveList!\n        rows: [ListRowButton]\n    }\n    type ListRowButton {\n        id: Int!\n        buttonId: String\n        title: String\n        description: String\n        \n        listSection: ListSection\n        product: Product\n    }\n    \n    type ListRepliedAction {\n        id: Int\n        buttonId: String\n        title: String\n        description: String\n\n        message: Message\n        listReply: ListRowButton\n    }\n\n###################################INTERACTIVE TEMPLATE##################################\n    type InteractiveTemplate {\n        id: Int!\n        header: String\n        body: String\n        footer: String\n        action: String  # action you want the user to take\n        \n        buttons: [TemplateReplyAction] # the actions the user can take\n        interactiveMessage: InteractiveMessage!\n        tempProduct: Product\n        tempImageHead: ImageHeader\n        tempTextHead: TextHeader\n    }\n    type TemplateReplyAction {\n        id: Int!\n        template: InteractiveTemplate!\n        text: String!\n    }\n    type TemplateRepliedAction {\n        id: Int\n        text: String\n        payload: String\n\n        message: Message\n        tempReply: InteractiveTemplate\n    }\n\n####################################################MESSAGE HEADERS##############################\n\n    type ImageHeader {\n        link: String!\n    }\n    type TextHeader {\n        body: String\n    }\n    type DocumentHeader {\n        link: String\n        mimeType: String\n        filename: String\n    }\n    type VideoHeader {\n        link: String\n    }\n\n    type MessageFeed {\n        cursor: String! # The place in the list where we left off\n        messages: [Message]! # A chunk\n    }\n    type Setting {\n        callBack_url: String!\n        APP_ID:String!\n        APP_SECRET:String!\n        PHONE_NUMBER_ID:String!\n        BUSINESS_ACCOUNT_ID:String!\n        ACCESS_TOKEN:String!\n        API_VERSION:String!\n        WEBHOOK_VERIFICATION_TOKEN:String!\n        RECIPIENT_PHONE_NUMBER:String\n    }\n\n    ###########################  STORE SCHEMA #############################\n    type Store {\n        id:  Int!\n        name: String!\n        merchant: Merchant\n        billboards: [Billboard]\n        sizes: [Size]\n        colors: [Color]\n        products: [Product]\n        createdAt: Date!\n        updatedAt: Date!\n    }\n    type Billboard {\n        id: Int!\n        label: String!\n        imageUrl: String\n        store: Store\n        categories: [Category]\n        createdAt: Date!\n        updatedAt: Date!\n    }\n    type Category {\n        id: Int!\n        name: String!\n        store: Store!\n        products: [Product]\n        billboard: Billboard!\n        updatedAt: Date!\n    }\n    type Size {\n        id: Int!\n        name: String!\n        value: String!\n        store: Store!\n        updatedAt: Date!\n    }\n    type Color {\n        id: Int!\n        name: String!\n        value: String!\n        store: Store!\n        updatedAt: Date!\n    }\n    ###########################  PRODUCT SCHEMA #############################\n    type Product{\n        id: Int!\n        name: String!\n        price: Int!\n        isFeatured: Boolean\n        isArchived: Boolean\n        size: Size\n        color: Color\n        category: Category!\n        store: Store!\n        images: [Image]\n\n        prodVariations: [ProductVariation]\n        prodCombinations: [ProductCombination]\n\n        updatedAt: Date\n    }\n    type ProductVariation {\n        name: String\n\n        prodVariation: Product\n        prodVarOptions: [ProductVariationOption]\n    }\n    type ProductVariationOption {\n        value: String\n        prodVarOption: ProductVariation\n    }\n    type ProductCombination {\n        price: String,\n        sku: String,\n        availableStock: Int\n        combinationString: String\n        variantImage: ProductImage\n        productVariants: [ProductVariationOption]\n\n        prodCombination: Product,\n    }\n    \n    type ProductImage {\n        link: String\n    }\n\n    type Image {\n        id: Int!\n        url: String!\n        productId: Int!\n        storeId: Int!\n    }\n\n    ###########################  ORDERS SCHEMA #############################\n    type Order {\n        id: Int!\n        orderID: String\n        isPaid: Boolean!\n        phone: String!\n        status: String!\n        address: String!\n        storeOrder: Store\n        customerOrder: Customer\n        orderItems: [OrderItem]!\n        createdAt: Date\n        updatedAt: Date\n    }\n    type OrderItem {\n        id: Int!\n        price: Int!\n        quantity: Int!\n        productId: Int\n        order: Order\n        orderProduct: Product!\n    }\n\n    type CusChatSearch {\n        chats: [Chat]\n        customers: [Customer]\n    }\n    type ReturnedChat {\n        messages: [Message]\n        customer: Customer\n        conversations: [Conversation]\n    }\n\n    ###################### Marketing ####################################\n    type Ad {\n        id: Int!\n        merchantId: Int!\n        adTemplate: AdTemplate!\n        read: Int\n        delivered: Int\n        sent: Int\n        failed: Int\n        response: Int\n        updatedAt: Date\n    }\n    type AdTemplate {\n        id: Int!\n        name: String!\n        leads: Int\n        merchant: Merchant!\n        adTempProduct: Product\n        adTempMessage: Message\n        adTempResponses: [MarketingResponse]\n    }\n    type MarketingResponse {\n        id: Int!\n        cusTempLead: Customer\n        mesTempLead: Message\n        # prodTempLead: Product\n        # adTempLead: AdTemplate\n    }\n\n    ##################Task scheduling#####################\n\n    type ScheduleTask {\n        id: Int\n        merchantsTasks: Merchant\n        type: String\n        timestamp: Date\n        bulkTempTask: BulkTemplateTask\n    }\n\n    type BulkTemplateTask {\n        id: Int\n        schedule: ScheduleTask\n        message: String\n        template: String\n        customers: String\n    }\n\n    ############################################################\n    type RootQuery {\n        customers: [Customer] @auth\n        customer(customerId: Int!): Customer\n        customer360(customerId: Int!): Customer\n        chats: [Chat] @auth\n        chat(chatId: Int!): ReturnedChat @auth\n        lastMessage(chatId: Int!): Message @auth\n        setting(username: String): Setting\n        stores: [Store] @auth\n        allProducts: [Store] @auth\n   \n        store(storeId: Int):Store @auth\n        billboards(storeId: Int): [Billboard] @auth\n        billboard( billboardId: Int!):Billboard! \n        categories(storeId: Int!): [Category]\n        category(categoryId: Int!): Category!\n        sizes(storeId: Int!): [Size]\n        size(sizeId: Int!): Size!\n        colors(storeId: Int!): [Color]\n        color(colorId: Int!): Color!\n        products(storeId: Int!, categoryId: Int, sizeId: Int, colorId: Int): [Product]\n        productsIds( storeId: Int,productIds: [Int]): [Product]!\n        productsWithVariants(storeId: Int!, categoryId: Int, variantId: Int): [Product]\n        product(productId: Int!): Product!\n        orders(storeId: Int!): [Order]!\n        currentMerchant: Merchant @auth\n        customersSearch(page: Int, limit: Int, text: String!): [Customer] @auth\n        customerChatSearch(page: Int, limit: Int, text: String!): CusChatSearch @auth\n        ads: [Ad] @auth\n        tempMarketResponse(adTemplateId: Int!): AdTemplate @auth\n        templateSchedules: [ScheduleTask]\n    }\n\n\n\n    input CustomerInput {\n        whatsapp_name: String\n        phone_number: String!\n        first_name: String\n        last_name: String\n    }\n    input ChatInput {\n        merchant: Int\n        customer: Int!\n    }\n    input ChatStatus {\n        messageId: String\n        status: String\n    }\n\n    input MessageInput{\n        chatId: Int\n        messageId: String\n        status: String\n        from_customer: Boolean!\n        timestamp: Date!\n        type: String!\n    }\n\n    input ContextMessageInput {\n        messageId: String!\n    }\n\n    input TextInput{\n        body: String!\n    }\n    input TextMessageInput{\n        message: MessageInput!\n        text: TextInput!\n    }\n\n    input ImageInput {\n        caption: String\n        mimeType: String\n        sha256: String\n        imageId: String\n\n        url: String\n        AWfileId: String\n        AWbucketId: String\n    }\n    input ImageMessageInput{\n        message: MessageInput!\n        image: ImageInput\n    }\n\n    input DocumentInput {\n        caption: String\n        mimeType: String\n        sha256: String\n        filename: String\n        documentId: String\n        url: String\n    }\n    input DocumentMessageInput{\n        message: MessageInput!\n        document: DocumentInput\n    }\n\n    input VideoInput {\n        caption: String\n        mimeType: String\n        sha256: String\n        videoId: String\n\n        url: String\n    }\n    input VideoMessageInput{\n        message: MessageInput!\n        video: VideoInput\n    }\n##############################MESSAGE HEADER INPUTS##########################33\n    input ImageHeaderInput {\n        link: String!\n    }\n    input VideoHeaderInput {\n        link: String!\n    }\n    input TextHeaderInput {\n        body: String!\n    }\n    input DocumentHeaderInput {\n        link: String!\n        filename: String\n        mimeType: String\n    }\n###################################### BUTTON ###########################\n    input ButtonReplyActionInput {\n        buttonId: String!\n        title: String!\n    }\n    input InteractiveButtonInput {\n        header: String\n        btnImageHead: ImageHeaderInput\n        btnTextHead: TextHeaderInput\n        body: String\n        footer: String\n        action: String\n        productId: Int\n        buttons: [ButtonReplyActionInput]\n    }\n#################################LIST INPUT##########################\n    input ListRowButtonInput {\n        buttonId: String!\n        title: String!\n        description: String!\n        productId: Int\n        interactiveListId: Int\n    }\n    input ListSectionInput {\n        title: String\n        rows: [ListRowButtonInput]\n    }\n    input InteractiveListInput {\n        header: String\n        listTextHead: TextHeaderInput\n        body: String\n        footer: String\n        button: String\n        sections: [ListSectionInput]\n    }\n########################TEMPLATE INPUT################################################\n    input TemplateReplyActionInput {\n        text: String!\n    }\n    input InteractiveTemplateInput {\n        header: String\n        tempTextHead: TextHeaderInput\n        tempImageHead: ImageHeaderInput\n        body: String\n        footer: String\n        action: String\n        productId: Int\n        buttons: [TemplateReplyActionInput]\n    }\n    input InteractiveInput {\n        type: String!\n        button: InteractiveButtonInput\n        list: InteractiveListInput\n        template: InteractiveTemplateInput\n    }\n    input InteractiveMessageInput {\n        message: MessageInput!\n        interactive: InteractiveInput\n    }\n     ############Reply to template message###########\n    input TemplateRepliedActionInput {\n        text: String!\n        payload: String\n        \n        messageId: Int\n        interactiveTemplateId: Int \n    }\n\n    input TemplateRepliedInput {\n        message: MessageInput!\n        mesTempReply: TemplateRepliedActionInput\n    }\n \n############################################################3\n    input ButtonRepliedActionInput {\n        buttonId: String!\n        title: String!\n        \n        messageId: Int\n        interactiveButtonId: Int \n    }\n    input ButtonRepliedInput {\n        message: MessageInput!\n        mesBtnReply: ButtonRepliedActionInput\n    }\n################################################\n    input ListRepliedInput {\n        message: MessageInput!\n        mesListReply: ListRepliedActionInput\n    }\n    input ListRepliedActionInput {\n        buttonId: String!\n        title: String!\n        description: String!\n        messageId: Int\n        listRowButtonId: Int \n    }\n\n#####################################\n\n    input ParticipantsInput{\n        mer_username: String!\n        customer: CustomerInput!\n    }\n\n    input SettingInput {\n        callBack_url: String\n        APP_ID:String\n        APP_SECRET:String\n        PHONE_NUMBER_ID:String\n        BUSINESS_ACCOUNT_ID:String\n        ACCESS_TOKEN:String\n        API_VERSION:String\n        WEBHOOK_VERIFICATION_TOKEN:String\n        RECIPIENT_PHONE_NUMBER:String\n    }\n    input MerchantInput {\n        business_name: String!\n        username: String!\n        password: String!\n        email: String\n        whatsapp_phone_number: String\n    }\n    type ReqNotification{\n        notification: String!\n    }\n    type Auth {\n        token: String\n        merchant: Merchant\n    }\n\n    type Response {\n        success: String\n    }\n\n    input StoreInput{\n        name: String!\n    }\n\n    input BillboardInput {\n        label: String\n        imageUrl: String\n        storeId: Int!\n    }\n    input CategoryInput {\n        name: String!\n        billboardId: Int!\n    }\n    input SizeInput {\n        name: String!\n        value: String!\n        storeId: Int!\n    }\n    input ColorInput {\n        name: String!\n        value: String!\n        storeId: Int!\n    }\n    ################################## ADD A PRODUCT  #############\n    input ProductInput{\n        name: String!\n        price: Int!\n        images: [ImageInput]\n        isFeatured: Boolean\n        isArchived: Boolean\n        categoryId: Int!\n        storeId: Int!\n\n        prodVariations: [ProductVariationInput]\n        prodCombinations: [ProductCombInput]\n    }\n    input ProductVariationInput {\n        name: String,\n        prodVarOptions: [ProductVarOptionInput]\n    }\n    input ProductVarOptionInput {\n        value: String\n    }\n    input ProductCombInput {\n        price: Int\n        sku: String\n        availableStock: Int\n        combinationString: String\n        variantImage: ProductImageInput\n        productVariants: [ProductVariationInput]\n    }\n\n    input ProductImageInput {\n        link: String!\n        storeId: Int!\n    }\n\n    input ImageInput {\n        url: String!\n        storeId: Int\n        productId: Int\n    }\n\n\n    input OrderInput {\n        customerId: Int\n        isPaid: Boolean\n        phone_number: String!\n        address: String\n\n        orderItems: [OrderItemInput]\n    }\n    input OrderCheckoutInput {\n        isPaid: Boolean\n        phone_number: String!\n        address: String!\n    }\n    input OrderItemInput {\n        productId: Int!\n        price: Int!\n        quantity: Int!\n    }\n\n    ###################### Scheduling task #####################\n    input ScheduleTaskInput {\n        type: String!\n        status: String!\n        timestamp: Date!\n        bulkTempTask: TemplateTaskInput\n    }\n    input TemplateTaskInput {\n        message: String\n        template: String\n        customers: String\n    }\n  \n\n    type RootMutation {\n        addCustomer (\n            customer: CustomerInput!\n        ): Customer\n        addChat (\n            chat: ChatInput!\n        ): Chat\n        addTextMessage (\n            message: TextMessageInput!\n            template: String,\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addTemplateMesBulk (\n            message: InteractiveMessageInput!\n            selectedCustomers: String!\n            template: String\n        ): Message\n        addImageMessage (\n            message: ImageMessageInput!\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addDocumentMessage (\n            message: DocumentMessageInput!\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addVideoMessage (\n            message: VideoMessageInput!\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addInteractiveButtonMessage (\n            message: InteractiveMessageInput!\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addInteractiveTemplateMessage (\n            message: InteractiveMessageInput,\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addInteractiveListMessage (\n            message: InteractiveMessageInput!\n            template: String\n            participants: ParticipantsInput\n            customerId: Int\n            contextMessage: ContextMessageInput\n        ): Message\n        addButtonRepliedMessage (\n            message: ButtonRepliedInput!\n            participants: ParticipantsInput\n            contextMessage: ContextMessageInput\n        ): Message\n        addTemplateRepliedMessage (\n            message: TemplateRepliedInput!\n            participants: ParticipantsInput\n            contextMessage: ContextMessageInput\n        ): Message\n        addListRepliedMessage (\n            message: ListRepliedInput!\n            participants: ParticipantsInput\n            contextMessage: ContextMessageInput\n        ): Message\n        addSetting (\n            setting: SettingInput!\n        ): Setting @auth\n        addStore (\n            store: StoreInput!\n        ): Store @auth\n        addBillboard (\n            billboard: BillboardInput!\n        ): Billboard @auth\n        addCategory (\n            category: CategoryInput!\n        ): Category @ auth\n        addSize (\n            size: SizeInput!\n        ): Size @auth\n        addColor (\n            color: ColorInput!\n        ): Color @auth\n\n\n        addProduct (\n            product: ProductInput!\n        ): Product @auth\n        addProductVariations (\n            product: ProductInput\n        ): Product @auth\n\n        addImage (\n            image: ImageInput!\n        ): Image @auth\n        addOrder(\n            order: OrderInput!\n            storeId: Int!\n        ): Order\n        addBulkTemplateTask(\n            schedule: ScheduleTaskInput!\n        ): ScheduleTask @auth\n\n        updateChatStatus (\n            participants: ParticipantsInput\n            payload: ChatStatus!\n        ): Message\n        updateMessageStatus(\n            id: Int,\n            messageId: String,\n        ): Message @auth\n        updateStore (\n            storeId: Int!\n            payload: StoreInput!\n        ): Store @auth\n        updateBillboard (\n            billboardId: Int!\n            payload: BillboardInput!\n        ): Billboard @auth\n        updateCategory (\n            categoryId: Int!\n            payload: CategoryInput!\n        ): Category @auth\n        updateSize (\n            sizeId: Int!\n            payload: SizeInput!\n        ): Size @auth\n        updateColor (\n            colorId: Int!\n            payload: ColorInput!\n        ): Color @auth\n        updateProduct (\n            productId: Int!\n            payload: ProductInput!\n        ): Product @auth\n        updateProductVariation (\n            productId: Int!\n            payload: ProductInput!\n        ): Product @auth\n        updateOrderCheckout (\n            orderId: Int!\n            storeId: Int!\n            payload: OrderCheckoutInput!\n        ): Order\n        updateCustomer (\n            customerId: Int!\n            payload: CustomerInput!\n        ): Customer @auth\n        updateBulkTemplateTask(\n            taskId: Int!\n            merchantId: Int!\n        ): Response\n\n        deleteStore (\n            storeId: Int!\n        ): Response @auth\n        deleteBillboard (\n            storeId: Int!\n            billboardId: Int!\n        ): Response @auth\n        deleteCategory (\n            categoryId: Int!\n            storeId: Int!\n        ): Response @auth\n        deleteSize (\n            storeId: Int!\n            sizeId: Int!\n        ): Response @auth\n        deleteColor (\n            storeId: Int!\n            colorId: Int!\n        ): Response @auth\n        deleteProduct(\n            productId: Int!\n            storeId: Int!\n        ): Response @auth\n        deleteImage(\n            imageId: Int!\n            productId: Int!\n        ): Response @auth\n\n        loginMerchant (\n            username: String!\n            password: String!\n        ): Auth\n        signupMerchant (\n            username: String!\n            password: String!\n            whatsapp_phone_number: String!\n            email: String\n        ): Auth\n        logoutMerchant: Response\n    } \n\n    type ChatUpdated { \n        message: Message\n        chat: Chat \n    } \n   \n    type RootSubscription {\n        chatAdded(merchantId: Int!): Chat # when a new chat is created\n        messageAdded(chatId: Int!): ChatUpdated  # the channel client to subscribe to messageAdded\n    }\n\n    schema { \n        query: RootQuery\n        mutation: RootMutation\n        subscription: RootSubscription\n    }\n"]},851:(e,t,n)=>{var r=n(6617),a=n(8714);e.exports=function(e){return{subscriptions:a(e),graphql:r.server(e)}}},8714:(e,t,n)=>{var r=n(7738),a=n(8063),o=n(5564),s=n(829),i=n(7898),c=n(6854),u=n(2511),d=(n(3672),n(5963).makeExecutableSchema),l=n(5086).WebSocketServer,p=n(7205).useServer;n(818).config();var m=process.env.JWT_SECRET;e.exports=function(e){return function(t){var n,h=d({typeDefs:c,resolvers:i.call(e),schemaDirectives:{auth:u}}),f=new l({server:t,path:"/subscriptions"});p({schema:h,onConnect:(n=o(r.mark((function t(n){var o,i,c;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.connectionParams.Authorization,"undefined"===a(o)){t.next=8;break}return i=new RegExp("Bearer","ig"),c=o.replace(i,"").trim(),t.abrupt("return",s.verify(c,m,(function(t,r){if(t)throw new Error("Missing authentication!".bgGreen);return e.db.db.models.Merchant.findByPk(r.id).then((function(e){return n.extra.merchant=e,{merchant:e}}))})));case 8:throw new Error("Missing auth token".bgRed);case 9:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)}),context:function(e){var t=e.extra;return t.request,{merchant:t.merchant}},onDisconnect:function(e,t,n){console.info("Disconnected from the websocket subscriptions".red)}},f)}}},1255:(e,t,n)=>{var r=n(7738),a=n(5564),o=(n(9113),n(3236)),s=o.saveTextMessageToDB,i=o.saveImageMessageToDB,c=o.saveDocumentMessageToDB,u=o.saveVideoMessageToDB,d=o.updateChatStatus,l=o.saveReplyToButtonMessage,p=o.saveReplyToListMessage,m=o.saveReplyToTemplateMessage;function h(){return(h=a(r.mark((function e(t){var n,a,o,h,f,g,I,v,b,x,y,w,E,T,k,S,R,M,C,O,N,A,P,B,_,D,G,q,L;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.query.username,a={mer_username:n,customer:{phone_number:void 0}},o={contextMessage:void 0,message:void 0,participants:void 0},!(h=(h=t.body).entry)[0].changes[0].value){e.next=163;break}if(!(f=h[0].changes[0].value).statuses){e.next=18;break}I=f.statuses,console.log(I),console.log(I[0].errors),console.log("############STATUS OF THE SENT MESSAGE############"),a.customer.phone_number=null===(g=I[0])||void 0===g?void 0:g.recipient_id;try{d({participants:a,payload:{status:I[0].status,messageId:null===(v=I[0])||void 0===v?void 0:v.id}})}catch(e){console.log(e)}I[0].conversation&&(console.log("MEE conversation>>>>: ",I[0].conversation),console.log("MSG conversation ID>: ",I[0].conversation.id),console.log("MSG conExp ",I[0].conversation.expiration_timestamp)),I[0].pricing&&(console.log("MSG PRICING>>>>>>>>>: ",I[0].pricing),console.log("MSG PRICING MODEL>>>: ",I[0].pricing.pricing_model),console.log("MSG PRICING CATEGORY: ",I[0].pricing.category)),e.next=163;break;case 18:if(!f.messages){e.next=163;break}if(b={message:{}},x={},console.log("############RECEIVING A MESSAGE FROM CUSTOMER#############"),y=f.messages,console.log(y),y[0].context&&(w=y[0].context,o.contextMessage={messageId:w.id}),x.phone_number=y[0].from,a.customer=x,o.participants=a,b.message.from_customer=!0,b.message.timestamp=(new Date).getTime(),b.message.messageId=y[0].id,b.message.status="delivered","text"!==(E=y[0].type)){e.next=48;break}return T={body:y[0].text.body},b.message.type="TEXT",b.text=T,o.message=b,e.prev=38,e.next=41,s(o);case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(38),console.log("could not save the message to database");case 46:e.next=163;break;case 48:if("interactive"!==E){e.next=86;break}if(b.message.type="BUTTON_REPLY",console.log("$$$$$$ AN INTERACTIVE TYPE MESSAGE from interactive button $$$$$$$$$"),"button_reply"!==(k=y[0].interactive).type){e.next=68;break}return console.log("$$$$$$ A BUTTON INTERACTIVE TYPE"),S=k.button_reply,R={buttonId:S.id,title:S.title},b.mesBtnReply=R,o.message=b,e.prev=58,e.next=61,l(o);case 61:e.next=66;break;case 63:e.prev=63,e.t1=e.catch(58),console.log("could not save the message to database");case 66:e.next=84;break;case 68:if("list_reply"!==k.type){e.next=84;break}return b.message.type="LIST_REPLY",console.log("$$$$$$ A LIST INTERACTIVE TYPE"),M=k.list_reply,C={buttonId:M.id,title:M.title,description:M.description},b.mesListReply=C,o.message=b,console.log(o),e.prev=76,e.next=79,p(o);case 79:e.next=84;break;case 81:e.prev=81,e.t2=e.catch(76),console.log("could not save the message to database");case 84:e.next=163;break;case 86:if("button"!==E){e.next=105;break}return b.message.type="TEMP_REPLY",console.log("$$$$$$ AN BUTTON TYPE MESSAGE from template $$$$$$$$$"),console.log("Interactive>>>>>>>: ",y[0].button),O=y[0].button,N={text:O.text,payload:O.payload},b.mesTempReply=N,o.message=b,console.log("THE PAYLOAD",o),e.prev=95,e.next=98,m(o);case 98:e.next=103;break;case 100:e.prev=100,e.t3=e.catch(95),console.log("could not save the message to database");case 103:e.next=163;break;case 105:if("image"!==E){e.next=124;break}return console.log("$$$$$$$$ AN IMAGE TYPE MESSAGE $$$$$$$$$$"),A=y[0].image,P={url:"https://res.cloudinary.com/dzeeuz5g6/image/upload/v1702201840/qa9iszb4ebczgxffka5n.jpg",imageId:A.id,sha256:A.sha256,mimeType:A.mime_type},A.caption&&(P.caption=A.caption),b.message.type="IMAGE",b.image=P,console.log(b),o.message=b,e.prev=114,e.next=117,i(o);case 117:e.next=122;break;case 119:e.prev=119,e.t4=e.catch(114),console.log("could not save the message to database");case 122:e.next=163;break;case 124:if("document"!==E){e.next=143;break}return console.log("$$$$$$$$ AN DOCUMENT TYPE MESSAGE $$$$$$$$$$"),B=y[0].document,_={url:"https://cloud.appwrite.io/v1/storage/buckets/657c8507c305096354f8/files/657e55198a707f669611/download?project=657c827f1c5737986d84",documentId:B.id,filename:B.filename,mimeType:B.mime_type,sha256:B.sha256},B.caption&&(_.caption=B.caption),b.message.type="DOCUMENT",b.document=_,console.log(_),o.message=b,e.prev=133,e.next=136,c(o);case 136:e.next=141;break;case 138:e.prev=138,e.t5=e.catch(133),console.log("could not save the message to database");case 141:e.next=163;break;case 143:if("video"!==E){e.next=162;break}return console.log("$$$$$$$$ AN VIDEO TYPE MESSAGE $$$$$$$$$$"),D=y[0].video,G={url:"",videoId:D.id,mimeType:D.mime_type,sha256:D.sha256},D.caption&&(G.caption=D.caption),b.message.type="VIDEO",b.video=G,console.log(G),o.message=b,e.prev=152,e.next=155,u(o);case 155:e.next=160;break;case 157:e.prev=157,e.t6=e.catch(152),console.log("could not save the message to database");case 160:e.next=163;break;case 162:"audio"===E?(console.log("$$$$$$$$ AN audio TYPE MESSAGE $$$$$$$$$$"),q=y[0].audio,console.log("audio mime_type>: ",q.mime_type),console.log("audio sha256>>>>>: ",q.sha256),console.log("audio id>>>>>>>>>: ",q.id),console.log("audio is voicd",q.voice)):"location"===E&&(console.log("$$$$$$$$ A Location TYPE MESSAGE $$$$$$$$$$"),L=y[0].location,console.log(L),console.log("location address>: ",L.address),console.log("location latitude>>>>>: ",L.latitude),console.log("location name>>>>>>>>>: ",L.name),console.log("location url",L.url));case 163:case"end":return e.stop()}}),e,null,[[38,43],[58,63],[76,81],[95,100],[114,119],[133,138],[152,157]])})))).apply(this,arguments)}t&&(t.getPayload=function(e){return h.apply(this,arguments)})},8059:(e,t,n)=>{n(818).config();var r=new(0,n(2369).GraphQLClient)("".concat(process.env.GRAPHQLURI,"/graphql"),{headers:{"content-type":"application/json"}});e.exports=r},8780:(e,t)=>{t&&(t.interactiveList={messaging_product:"whatsapp",recipient_type:"individual",to:"PHONE_NUMBER",type:"interactive",interactive:{type:"list",header:{type:"text",text:"Add an Item to Existing Pending Order"},body:{text:"View our list of produce to add to your existing order. Hurry before your order is out for delivery!"},footer:{text:"Markt online groceries"},action:{button:"Products List",sections:[{title:"Fresh Produce",rows:[{id:"SECTION_1_ROW_1_ID",title:"SECTION_1_ROW_1_TITLE",description:"SECTION_1_ROW_1_DESCRIPTION"},{id:"SECTION_1_ROW_2_ID",title:"SECTION_1_ROW_2_TITLE",description:"SECTION_1_ROW_2_DESCRIPTION"}]},{title:"Fresh Produce Cont",rows:[]}]}}},t.interactiveReplyButton={messaging_product:"whatsapp",recipient_type:"individual",to:"PHONE_NUMBER",type:"interactive",interactive:{type:"button",body:{text:"Do you want to add an item to your order?"},action:{buttons:[{type:"reply",reply:{id:"0",title:"No"}},{type:"reply",reply:{id:"1",title:"Yes"}}]}}})},6919:(e,t,n)=>{var r=n(7738),a=n(5564),o=(n(3672).colors,n(8938)),s=n(4104),i=process.env.ACCESS_TOKEN,c=process.env.API_VERSION,u=(process.env.RECIPIENT_PHONE_NUMBER,process.env.PHONE_NUMBER_ID),d=process.env.BUSINESS_ACCOUNT_ID,l={};function p(){return(p=a(r.mark((function e(t,n){var a,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"post",url:"https://graph.facebook.com/".concat(n.API_VERSION,"/").concat(n.PHONE_NUMBER_ID,"/messages"),headers:{Authorization:"Bearer ".concat(n.ACCESS_TOKEN),"Content-Type":"application/json"},data:JSON.stringify(t)},e.prev=1,e.next=4,o(a);case 4:return s=e.sent,e.abrupt("return",s);case 8:if(e.prev=8,e.t0=e.catch(1),console.log("An error occured while sending message ".concat(e.t0.message).bgRed,e.t0.response.data),"131030"!==e.t0.code){e.next=14;break}return console.log("Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.".bgRed),e.abrupt("return");case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function m(){return(m=a(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"put",url:"https://graph.facebook.com/".concat(c,"/").concat(u,"/messages"),headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},data:t},e.next=3,o(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=a(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({method:"get",url:"https://graph.facebook.com/".concat(c,"/").concat(d,"/message_templates")+"?limit=1000",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=a(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sending a request to whatsapp to createMessageTemplate  name:"+process.env.TEMPLATE_NAME_PREFIX+"_"+t.name),n={method:"post",url:"https://graph.facebook.com/".concat(c,"/").concat(d,"/message_templates"),headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},data:{name:process.env.TEMPLATE_NAME_PREFIX+"_"+t.name,category:t.category,components:t.components,language:t.language}},e.next=4,o(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={sendWhatsAppMessage:function(e,t){return p.apply(this,arguments)},updateWhatsAppMessage:function(e){return m.apply(this,arguments)},listTemplates:function(){return h.apply(this,arguments)},createMessageTemplate:function(e){return f.apply(this,arguments)},getMessageData:function(e,t){var n,r=s[t.statusId-1];switch(r.name){case"welcome":n=[{type:"text",text:t.customer.split(" ")[0]}];break;case"payment_analysis":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:l[t.items[0].productId-1].name}];break;case"payment_approved":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:t.id},{type:"text",text:t.deliveryDate}];break;case"invoice_available":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:l[t.items[0].productId-1].name},{type:"text",text:"https://customer.your-awesome-grocery-store-demo.com/my-account/orders/".concat(t.id)}];break;case"order_picked_packed":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:t.id},{type:"text",text:"https://customer.your-awesome-grocery-store-demo.com/my-account/orders/".concat(t.id)}];break;case"order_in_transit":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:t.id},{type:"text",text:t.deliveryDate},{type:"text",text:"https://customer.your-awesome-grocery-store-demo.com/my-account/orders/".concat(t.id)}];break;case"order_delivered":n=[{type:"text",text:t.customer.split(" ")[0]},{type:"text",text:t.id},{type:"text",text:t.deadlineDays}]}var a={messaging_product:"whatsapp",to:e,type:"template",template:{name:process.env.TEMPLATE_NAME_PREFIX+"_"+r.name,language:{code:"en_US"},components:[{type:"body",parameters:n}]}};return JSON.stringify(a)},createProductsList:function(e){return{id:"".concat(e.id),title:e.name,description:"$".concat(e.price)}}}},9173:(e,t)=>{t&&(t.messageStatuses={read:{messaging_product:"whatsapp",status:"read",message_id:""},sent:{messaging_product:"whatsapp",status:"sent",message_id:""}})},4104:(e,t)=>{t&&(t.messageTemplates=[{name:"welcome",category:"UTILITY",components:[{type:"BODY",text:"Hi, {{1}}! How great to have you here \n\nNow, as soon as you buy with us, you will receive automatic messages about the progress of your order here.\n\nAnd whenever you want, you can ask about your latest orders, our offer of the day or the addresses and opening hours of our physical stores.",example:{body_text:[["Bob"]]}}],language:"en_US",modelFields:["firstName"]},{name:"payment_analysis",category:"UTILITY",components:[{type:"BODY",text:"Hello, {{1}}!\n\nThank you for shopping with us \n\nWe received the order for the product {{2}} and now we are just waiting for the payment to be approved.\n\nTo know about your purchase anytime, just send a message here and we'll tell you :)",example:{body_text:[["Bob","Olive Oil"]]}}],language:"en_US",modelFields:["firstName","productName"]},{name:"payment_approved",category:"UTILITY",components:[{type:"BODY",text:"Hello, {{1}}!\n\nPayment for order {{2}} has been approved \n\nWe are working to have your order delivered by {{3}}.",example:{body_text:[["Bob","02-953022600","June 9"]]}}],language:"en_US",modelFields:["firstName","orderNumber","deliveryDate"]},{name:"invoice_available",category:"UTILITY",components:[{type:"BODY",text:"Hello, {{1}}!\n\nYou can download the invoice for the product {{2}} here: {{3}}.",example:{body_text:[["Bob","OLIVE OIL","https://customer.your-awesome-grocery-store-demo.com/my-account/orders/02-953022600"]]}}],language:"en_US",modelFields:["firstName","productName","orderUrl"]},{name:"order_picked_packed",category:"UTILITY",components:[{type:"BODY",text:"Hello, {{1}}!\n\nOrder {{2}} has already been picked and packed \n\nAnd it's ready to get to you soon.\n\nIf you want to track shipping, it's here  {{3}}",example:{body_text:[["Bob","02-950515063","https://customer.your-awesome-grocery-store-demo.com/my-account/orders/02-953022600"]]}}],language:"en_US",modelFields:["firstName","orderNumber","orderUrl"]},{name:"order_in_transit",category:"UTILITY",components:[{type:"BODY",text:"Hello {{1}}, your order {{2}} is already on its way and will be delivered to you on {{3}} :)\n\nIf you don't have a way to get it, let someone close to receive it for you, okay?\n\nYou can also track the shipment anytime here  {{4}}",example:{body_text:[["Bob","02-950515063","June 09","https://customer.your-awesome-grocery-store-demo.com/my-account/orders/02-953022600"]]}}],language:"en_US",modelFields:["firstName","orderNumber","deliveryDate","orderUrl"]},{name:"order_delivered",category:"UTILITY",components:[{type:"BODY",text:"Hello {{1}}, order {{2}} has been delivered!\n\nEnjoy it! \n\nIf you have any problems and want to exchange or return, the deadline is {{3}} calendar days. To order, just enter the My Account section of the website or app, find the product(s) in My Orders and click on exchange or return. We only do not exchange if there are signs that the product has been used, such as damaged labels and broken seals, ok?\n\nThanks for shopping with us!\n\nSee you later ",example:{body_text:[["Bob","02-950515063","7"]]}}],language:"en_US",modelFields:["firstName","orderNumber","deadlineDays"]}])},8430:(e,t,n)=>{var r=n(7738),a=n(5564),o=n(8780),s=o.interactiveList,i=o.interactiveReplyButton,c=n(6919),u=c.createProductsList,d=(c.updateWhatsAppMessage,c.sendWhatsAppMessage,[{id:1,name:"assorted berries",thumbnail:"2010/12/13/10/05/berries-2277__340.jpg",price:2.99},{id:2,name:"tomato",thumbnail:"2014/04/10/11/06/tomatoes-320860__340.jpg",price:1.99},{id:3,name:"oranges",thumbnail:"2017/01/20/15/06/oranges-1995056__340.jpg",price:3.99},{id:4,name:"cherries",thumbnail:"2016/06/18/22/36/cherries-1465801__340.jpg",price:2.99},{id:5,name:"pistacchio",thumbnail:"2018/03/13/20/08/pistachios-3223610__340.jpg",price:5.99},{id:6,name:"carrots",thumbnail:"2017/06/09/16/39/carrots-2387394__340.jpg",price:2.99},{id:7,name:"onions",thumbnail:"2016/05/16/22/47/onions-1397037__340.jpg",price:1.99},{id:8,name:"potatoes",thumbnail:"2014/08/06/20/32/potatoes-411975__340.jpg",price:1.99},{id:9,name:"broccoli",thumbnail:"2015/03/14/13/59/vegetables-673181__340.jpg",price:3.99},{id:10,name:"coffee",thumbnail:"2016/08/07/16/23/coffee-1576537__340.jpg",price:3.99},{id:11,name:"salmon",thumbnail:"2016/03/05/19/02/salmon-1238248__340.jpg",price:5.99},{id:12,name:"sausages",thumbnail:"2018/07/08/20/18/sausages-3524649__340.jpg",price:3.99},{id:13,name:"chicken wings",thumbnail:"2016/07/31/17/51/chicken-1559548__340.jpg",price:5.99},{id:14,name:"brie",thumbnail:"2015/02/10/02/42/cheese-630511__340.jpg",price:7.99},{id:15,name:"rice",thumbnail:"2019/02/15/03/28/rice-3997767__340.jpg",price:4.99},{id:16,name:"blonde ale beer",thumbnail:"2017/01/21/21/15/beer-1998293__340.jpg",price:3.99}]);function l(){return(l=a(r.mark((function e(t,n){var a,o,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.from,"text"===(a=t.type)){t.text.body;try{i.to=n.RECIPIENT_PHONE_NUMBER}catch(e){console.log("ERROR SENDING THE REPLY buttons",e)}}else if("interactive"===a)if("button_reply"===(o=t.interactive.type)){if(c=t.interactive.button_reply.id,t.interactive.button_reply.title,console.log("BUTTON ID###############",c),1==c)try{(l=s).to=n.RECIPIENT_PHONE_NUMBER,l.interactive.action.sections[0].rows=d.map(u),l.interactive.action.sections[0].rows.length=10}catch(e){console.log("ERROR SENGING THE LIST################",e.message)}}else"list_reply"===o&&(t.interactive.list_reply.id,t.interactive.list_reply.title,t.interactive.list_reply.description);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(e,t){return l.apply(this,arguments)}},3236:(e,t,n)=>{var r,a,o,s,i,c,u,d,l=n(7738),p=n(5564),m=n(4979),h=n(8059),f=n(2369).gql,g=f(r||(r=m(["\n  mutation AddTextMessage(\n    $message: TextMessageInput!\n    $participants: ParticipantsInput\n    $contextMessage: ContextMessageInput\n  ) {\n    addTextMessage(\n      message: $message\n      participants: $participants\n      contextMessage: $contextMessage\n    ) {\n      id\n    }\n  }\n"]))),I=f(a||(a=m(["\n  mutation AddImageMessage(\n    $message: ImageMessageInput!\n    $participants: ParticipantsInput\n    $contextMessage: ContextMessageInput\n  ) {\n    addImageMessage(\n      message: $message\n      participants: $participants\n      contextMessage: $contextMessage\n    ) {\n      id\n    }\n  }\n"]))),v=f(o||(o=m(["\n  mutation AddDocumentMessage(\n    $message: DocumentMessageInput!\n    $participants: ParticipantsInput\n    $contextMessage: ContextMessageInput\n  ) {\n    addDocumentMessage(\n      message: $message\n      participants: $participants\n      contextMessage: $contextMessage\n    ) {\n      __typename\n      id\n    }\n  }\n"]))),b=f(s||(s=m(["\n  mutation AddVideoMessage(\n    $message: VideoMessageInput!\n    $participants: ParticipantsInput\n    $contextMessage: ContextMessageInput\n  ) {\n    addVideoMessage(\n      message: $message\n      participants: $participants\n      contextMessage: $contextMessage\n    ) {\n      id\n    }\n  }\n"]))),x=f(i||(i=m(["\n    mutation AddButtonRepliedMessage($message: ButtonRepliedInput!, $participants: ParticipantsInput, $contextMessage: ContextMessageInput) {\n    addButtonRepliedMessage(message: $message, participants: $participants, contextMessage: $contextMessage) {\n        id \n    }\n  }\n"]))),y=f(c||(c=m(["\n      mutation AddTemplateRepliedMessage($message: TemplateRepliedInput!, $participants: ParticipantsInput, $contextMessage: ContextMessageInput) {\n    addTemplateRepliedMessage(message: $message, participants: $participants, contextMessage: $contextMessage) {\n         __typename\n        id\n    }\n  }\n"]))),w=f(u||(u=m(["\n     mutation addListRepliedMessage($message: ListRepliedInput!, $participants: ParticipantsInput, $contextMessage: ContextMessageInput) {\n    addListRepliedMessage(message: $message, participants: $participants, contextMessage: $contextMessage) {\n        id\n    }\n  }\n"]))),E=f(d||(d=m(["\n  mutation updateChatStatus(\n    $participants: ParticipantsInput!\n    $payload: ChatStatus!\n  ) {\n    updateChatStatus(participants: $participants, payload: $payload) {\n      id\n    }\n  }\n"])));function T(){return(T=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,console.log("saveTextMessageToDB",t),e.prev=2,e.next=5,h.request(g,n);case 5:return e.sent,e.abrupt("return");case 9:e.prev=9,e.t0=e.catch(2),console.log("there was an error saving to the database",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function k(){return(k=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,console.log("saveImageMessageToDB",t),e.prev=2,e.next=5,h.request(I,n);case 5:return e.sent,e.abrupt("return");case 9:e.prev=9,e.t0=e.catch(2),console.log("there was an error saving to the database",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function S(){return(S=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(v,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function R(){return(R=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(b,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function M(){return(M=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(x,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function C(){return(C=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(y,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function O(){return(O=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(w,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function N(){return(N=p(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.prev=1,e.next=4,h.request(E,n);case 4:return e.sent,e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),console.log("there was an error saving to the database",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}t&&(t.saveTextMessageToDB=function(e){return T.apply(this,arguments)},t.saveImageMessageToDB=function(e){return k.apply(this,arguments)},t.updateChatStatus=function(e){return N.apply(this,arguments)},t.saveDocumentMessageToDB=function(e){return S.apply(this,arguments)},t.saveVideoMessageToDB=function(e){return R.apply(this,arguments)},t.saveReplyToButtonMessage=function(e){return M.apply(this,arguments)},t.saveReplyToListMessage=function(e){return O.apply(this,arguments)},t.saveReplyToTemplateMessage=function(e){return C.apply(this,arguments)})},3963:(e,t,n)=>{var r={"./ad.js":8412,"./adtemplate.js":718,"./billboard.js":354,"./bulktemplatetask.js":7190,"./buttonrepliedaction.js":8438,"./buttonreplyaction.js":6171,"./category.js":205,"./chat.js":491,"./color.js":1462,"./conversation.js":6002,"./customer.js":1469,"./documentmessage.js":9673,"./image.js":980,"./imageheader.js":9921,"./imagemessage.js":9833,"./interactivebutton.js":5117,"./interactivelist.js":2193,"./interactivemessage.js":8194,"./interactivetemplate.js":2163,"./listrepliedaction.js":3002,"./listrowbutton.js":8525,"./listsection.js":226,"./locationmessage.js":6007,"./marketingresponse.js":4674,"./merchant.js":3785,"./message.js":3050,"./order.js":6125,"./orderitem.js":5682,"./product.js":1506,"./productcombination.js":5611,"./productimage.js":3769,"./productvariant.js":9597,"./productvariation.js":3285,"./productvariationoption.js":8084,"./route.js":9248,"./scheduletask.js":2297,"./setting.js":4921,"./size.js":9560,"./store.js":9512,"./templaterepliedaction.js":1896,"./templatereplyaction.js":1757,"./textheader.js":7587,"./textmessage.js":5487,"./videomessage.js":5167};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=3963},6299:e=>{"use strict";e.exports=require("@apollo/server")},4772:e=>{"use strict";e.exports=require("@apollo/server/express4")},3133:e=>{"use strict";e.exports=require("@apollo/server/plugin/drainHttpServer")},5564:e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},5998:e=>{"use strict";e.exports=require("@babel/runtime/helpers/classCallCheck")},8898:e=>{"use strict";e.exports=require("@babel/runtime/helpers/createClass")},1116:e=>{"use strict";e.exports=require("@babel/runtime/helpers/defineProperty")},9285:e=>{"use strict";e.exports=require("@babel/runtime/helpers/getPrototypeOf")},2750:e=>{"use strict";e.exports=require("@babel/runtime/helpers/inherits")},4433:e=>{"use strict";e.exports=require("@babel/runtime/helpers/objectDestructuringEmpty")},6609:e=>{"use strict";e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},4979:e=>{"use strict";e.exports=require("@babel/runtime/helpers/taggedTemplateLiteral")},8063:e=>{"use strict";e.exports=require("@babel/runtime/helpers/typeof")},7738:e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},5963:e=>{"use strict";e.exports=require("@graphql-tools/schema")},6921:e=>{"use strict";e.exports=require("@graphql-tools/utils")},8938:e=>{"use strict";e.exports=require("axios")},5486:e=>{"use strict";e.exports=require("bcrypt")},3268:e=>{"use strict";e.exports=require("body-parser")},3672:e=>{"use strict";e.exports=require("colors")},7174:e=>{"use strict";e.exports=require("compression")},6898:e=>{"use strict";e.exports=require("cookie-parser")},2363:e=>{"use strict";e.exports=require("cookies")},8577:e=>{"use strict";e.exports=require("cors")},818:e=>{"use strict";e.exports=require("dotenv")},7252:e=>{"use strict";e.exports=require("express")},1253:e=>{"use strict";e.exports=require("graphql")},2369:e=>{"use strict";e.exports=require("graphql-request")},3946:e=>{"use strict";e.exports=require("graphql-subscriptions")},7205:e=>{"use strict";e.exports=require("graphql-ws/lib/use/ws")},6140:e=>{"use strict";e.exports=require("http-errors")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},2096:e=>{"use strict";e.exports=require("morgan")},9031:e=>{"use strict";e.exports=require("sequelize")},5124:e=>{"use strict";e.exports=require("winston")},5086:e=>{"use strict";e.exports=require("ws")},9113:e=>{"use strict";e.exports=require("x-hub-signature")},8611:e=>{"use strict";e.exports=require("http")},6928:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(7738),t=n(8063),r=n(5564),a=n(7252),o=(n(6140),n(6928)),s=n(6898),i=n(2096),c=n(3268),u=n(8577),d=n(4772).expressMiddleware,l=n(7174);n(818).config();var p=n(2363),m=n(829),h=n(8611).createServer,f=n(7906),g=n(8488),I=n(851),v=n(3482),b=a(),x=process.env.LISTEN_PORT||4e3,y=process.env.JWT_SECRET,w=h(b),E=["http://localhost:3000","http://cesNextClient:3000","https://graph.facebook.com","https://hello-customer.onrender.com"],T={origin:function(e,t){return e&&-1===E.indexOf(e)?t(new Error("The CORS policy for this site does not allow access from the specified Origin."),!1):t(null,!0)},credentials:!0};b.use(u(T)),b.use((function(e,t,n){var r={keys:["".concat(process.env.COOKIE_SIGNATURE)]};e.cookies=new p(e,t,r),n()}));var k={db:v},S=c.json;b.use(l()),b.use(c.json({verify:function(e,t,n){e.rawBody=n}})),b.set("views",o.join(__dirname,"views")),b.set("view engine","ejs"),b.use(i("dev")),b.use(a.json()),b.use(a.urlencoded({extended:!1})),b.use(s());var R=I(k);function M(){return M=r(e.mark((function n(){var a,o,s;return e.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=Object.keys(R),o=e.mark((function n(){var o,i;return e.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=a[s],n.t0=o,n.next="graphql"===n.t0?4:"subscriptions"===n.t0?9:11;break;case 4:return i=R.graphql,n.next=7,i.start();case 7:return b.use("/graphql",u(T),S(),d(i,{context:function(){var n=r(e.mark((function n(r){var a,o,s,i;return e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.req,o=a.headers.authorization,"undefined"===t(o)){e.next=11;break}return s=new RegExp("Bearer ","ig"),i=o.replace(s,"").trim(),console.log("From cookies".bgBlue,a.cookies.get("authorization",{signed:!0})),console.log("TOKEN$$$$$$$$$$$$$$$$$".bgBlue,i),e.abrupt("return",m.verify(i,y,(function(e,t){return e?a:k.db.db.models.Merchant.findByPk(t.id).then((function(e){return Object.assign({},a,{merchant:e})}))})));case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})),n.abrupt("break",13);case 9:console.log("SUBSCRIPTION SERVICES"),w.listen(x,(function(){console.log(" Server ready at http://localhost:".concat(x,"/graphql")),console.log("subscription",R[o]),R[o](w)}));case 11:return b.use("/${name}",R[o]),n.abrupt("break",13);case 13:case"end":return n.stop()}}),n)})),s=0;case 3:if(!(s<a.length)){n.next=8;break}return n.delegateYield(o(),"t0",5);case 5:s+=1,n.next=3;break;case 8:case"end":return n.stop()}}),n)}))),M.apply(this,arguments)}!function(){M.apply(this,arguments)}(),b.use("/createTemplates",f),b.use("/incoming",g),b.use((function(e,t,n,r){n.locals.message=e.message,n.locals.error="development"===t.app.get("env")?e:{},n.status(e.status||500),n.render("error")}))})()})();